<?xml version='1.0' encoding='utf-8'?>
<!-- -*- DocBook -*- -->
<chapter id="s-apache"><title>Apache</title>
<para>
Esta capítulo documenta a configuração, personalização, introdução aos
mecanismos de autenticação e controle de acesso do <command>Apache</command>,
sistema proxy, virtual hosting, e exemplos de configuração do servidor
<command>httpd</command>.  Ele não tem como objetivo ser uma referência
completa de configuração, mas sim abordar didaticamente o assunto.
</para>
<section id="s-apache-intro"><title>Introdução</title>
<para>
O servidor web é um programa responsável por disponibilizar páginas, fotos, ou
qualquer outro tipo de objeto ao navegador do cliente.  Ele também pode operar
recebendo dados do cliente, processando e enviando o resultado para que o
cliente possa tomar a ação desejada (como em aplicações CGI's, banco de dados
web, preenchimento de formulários, etc).
</para>
<para>
O <command>Apache</command> é um servidor Web extremamente configurável,
robusto e de alta performance desenvolvido por uma equipe de voluntários
(conhecida como <literal>Apache Group</literal>) buscando criar um servidor web
com muitas características e com código fonte disponível gratuitamente via
Internet.  Segundo a Netcraft (<ulink
url="http://www.netcraft.com/">http://www.netcraft.com/</ulink>), o
<command>Apache</command> é mais usado que todos os outros servidores web do
mundo juntos.
</para>
<para>
Este capítulo não tenta ser um guia completo ao <command>Apache</command>, mas
tentará mostrar como sua estrutura é organizada, as diretivas principais de
configuração, diretivas de segurança, virtual hosting, proxy, o uso de
utilitários de gerenciamento do servidor, como personalizar algumas partes do
servidor e programas úteis de terceiros para análise e diagnóstico do servidor
web.  Não deixe também de ver <xref linkend="s-apache-exemplo"/> pois contém
diretivas básicas de configuração comentadas e explicações interessante e faz
parte do aprendizado.
</para>
<section id="s-apache-versao"><title>Versão</title>
<para>
É assumido que esteja usando a versão 1.3.22 do <command>apache</command>.  As
explicações contidas aqui podem funcionar para versões posteriores, mas é
recomendável que leia a documentação sobre modificações no programa (changelog)
em busca de mudanças que alterem o sentido das explicações fornecidas aqui.
</para>
</section>

<section id="s-apache-historia"><title>Um resumo da História do Apache</title>
<para>
O <command>Apache</command> tem como base o servidor web <command>NCSA
1.3</command> (<emphasis>National Center of Supercomputing
Applications</emphasis>), que foi desenvolvido por Rob McCool.  Quando Rob
deixou o NCSA, o desenvolvimento foi interrompido, assim muitos desenvolvedores
buscaram personalizar sua própria versão do NCSA ou adicionar mais
características para atender as suas necessidades.  Neste momento começa a
história do <command>Apache</command> com <emphasis>Brian Behlendorf</emphasis>
e <emphasis>Cliff Skolnick</emphasis> abrindo uma lista de discussão para
interessados no desenvolvimento, conseguindo espaço em um servidor doado pela
<emphasis>HotWired</emphasis> e trocando patches corrigindo problemas,
adicionando recursos e discutindo idéias com outros desenvolvedores e hackers
interessados neste projeto.
</para>
<para>
A primeira versão oficial do <command>Apache</command> foi a 0.6.2, lançada em
Abril de 1995 (neste período a NCSA retomava o desenvolvimento de seu servidor
web, tendo como desenvolvedores <emphasis>Brandon Long</emphasis> e
<emphasis>Beth Frank</emphasis> que também se tornaram membros especiais do
grupo <command>Apache</command>, compartilhando idéias sobre seus projetos).
</para>
<para>
Nas versões 2.x do Apache, a escalabilidade do servidor foi ampliada suportando
as plataformas <command>Win32</command> (não obtendo o mesmo desempenho que em
plataformas UNIX mas sendo melhorado gradativamente).
</para>
</section>

<section id="s-apache-contribuindo"><title>Enviando Correções/Contribuindo com o projeto</title>
<para>
Um formulário está disponível na Web para o envio de correções/sugestões em
<literal><ulink
url="http://www.apache.org/bug_report.html/">http://www.apache.org/bug_report.html/</ulink></literal>.
Uma lista de anuncio sobre o <command>Apache</command> está disponível em
<email>apache-announce@apache.org</email> que divulgam correções, novas versões
e realização de eventos.
</para>
<para>
Mais detalhes sobre o desenvolvimento do Apache podem ser visualizadas na URL
<literal><ulink
url="http://dev.apache.org/">http://dev.apache.org/</ulink></literal>.
</para>
</section>

<section id="s-apache-caracteristicas"><title>Características do Apache</title>
<para>
Abaixo estão algumas características que fazem esse servidor web o preferido
entre os administradores de sistemas:
</para>
<itemizedlist>
<listitem>
<para>
Possui suporte a scripts cgi usando linguagens como <emphasis>Perl, PHP, Shell
Script, ASP, etc</emphasis>.
</para>
</listitem>
<listitem>
<para>
Suporte a autorização de acesso podendo ser especificadas restrições de acesso
separadamente para cada endereço/arquivo/diretório acessado no servidor.
</para>
</listitem>
<listitem>
<para>
Autenticação requerendo um nome de usuário e senha válidos para acesso a alguma
página/sub-diretório/arquivo (suportando criptografia via Crypto e MD5).
</para>
</listitem>
<listitem>
<para>
Negociação de conteúdo, permitindo a exibição da página Web no idioma
requisitado pelo Cliente Navegador.
</para>
</listitem>
<listitem>
<para>
Suporte a tipos mime.
</para>
</listitem>
<listitem>
<para>
Personalização de logs.
</para>
</listitem>
<listitem>
<para>
Mensagens de erro.
</para>
</listitem>
<listitem>
<para>
Suporte a virtual hosting (é possível servir 2 ou mais páginas com endereços/
portas diferentes através do mesmo processo ou usar mais de um processo para
controlar mais de um endereço).
</para>
</listitem>
<listitem>
<para>
Suporte a IP virtual hosting.
</para>
</listitem>
<listitem>
<para>
Suporte a name virtual hosting.
</para>
</listitem>
<listitem>
<para>
Suporte a servidor Proxy ftp e http, com limite de acesso, caching (todas
flexivelmente configuráveis).
</para>
</listitem>
<listitem>
<para>
Suporte a proxy e redirecionamentos baseados em URLs para endereços Internos.
</para>
</listitem>
<listitem>
<para>
Suporte a criptografia via SSL,Certificados digitais
</para>
</listitem>
<listitem>
<para>
Módulos DSO (Dynamic Shared Objects) permitem adicionar/remover funcionalidades
e recursos sem necessidade de recompilação do programa.
</para>
</listitem>
</itemizedlist>
</section>

<section id="s-apache-ficha"><title>Ficha técnica</title>
<para>
Pacote: <systemitem role="package">apache</systemitem>
</para>
<para>
Utilitários:
</para>
<itemizedlist>
<listitem>
<para>
<literal>apache</literal> - Servidor Web Principal
</para>
</listitem>
<listitem>
<para>
<literal>apachectl</literal> - Shell script que faz interface com o
<command>apache</command> de forma mais amigável
</para>
</listitem>
<listitem>
<para>
<literal>apacheconfig</literal> - Script em Perl para configuração interativa
básica do <command>Apache</command>
</para>
</listitem>
<listitem>
<para>
<literal>htpasswd</literal> - Cria/Gerencia senhas criptografadas Crypto/MD5
</para>
</listitem>
<listitem>
<para>
<literal>htdigest</literal> - Cria/Gerencia senhas criptografadas Crypto/MD5
</para>
</listitem>
<listitem>
<para>
<literal>dbmmanage</literal> - Cria/Gerencia senhas em formato DBM (Perl)
</para>
</listitem>
<listitem>
<para>
<literal>logresolve</literal> - Faz um DNS reverso dos arquivos de log do
<command>Apache</command> para obter o endereço de hosts com base nos endereços
IP's.
</para>
</listitem>
<listitem>
<para>
<literal>ab</literal> - Apache Benchmarcking - Ferramenta de medida de
desempenho do servidor Web Apache.
</para>
</listitem>
</itemizedlist>
<para>
Por padrão, os arquivos de configuração do <command>Apache</command> residem no
diretório <filename>/etc/apache</filename>:
</para>
<variablelist>
<varlistentry>
<term>httpd.conf</term>
<listitem>
<para>
Arquivo de configuração principal do <command>Apache</command>, possui
diretivas que controlam a operação do daemon servidor.  Um arquivo de
configuração alternativo pode ser especificado através da opção "-f" da linha
de comando.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>srm.conf</term>
<listitem>
<para>
Contém diretivas que controlam a especificação de documentos que o servidor
oferece aos clientes.  O nome desse arquivo pode ser substituído através da
diretiva ResourceConfig no arquivo principal de configuração.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>access.conf</term>
<listitem>
<para>
Contém diretivas que controlam o acesso aos documentos.  O nome desse arquivo
pode ser substituído através da diretiva <emphasis>AccessConfig</emphasis> no
arquivo principal de configuração.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
O servidor Web lê os arquivos acima na ordem que estão especificados
(<filename>httpd.conf</filename>, <filename>srm.conf</filename> e
<filename>access.conf</filename>).  As configurações também podem ser
especificadas diretamente no arquivo <filename>httpd.conf</filename>.  Note que
não é obrigatório usar os arquivos <filename>srm.conf</filename> e
<filename>access.conf</filename>, mas isto proporciona uma melhor organização
das diretivas do servidor, principalmente quando se tem um grande conjunto de
diretivas.  Um exemplo comentado destes três arquivos de configuração é
encontrado em <xref linkend="s-apache-exemplo"/>.
</para>
</section>

<section id="s-apache-hwreq"><title>Requerimentos</title>
<para>
A máquina mínima para se rodar um servidor <command>Apache</command> para
atender a uma rede padrão 10MB/s é um Pentium 90, 24MB de RAM, um HD com um bom
desempenho e espaço em disco considerável de acordo com o tamanho projetado de
seu servidor web (considerando seu crescimento).
</para>
<para>
Uma configuração mais rápida para redes 100MB/s teria como processador um Cyrix
MX ou Intel Pentium MMX como plataforma mínima (Cyrix é o recomendado pelo alto
desempenho no processamento de strings), barramento de HD SCSI com uma boa
placa controladora (Adaptec 19160 ou superior) com 64MB de RAM no mínimo.
</para>
</section>

<section id="s-apache-logs"><title>Arquivos de log criados pelo Apache</title>
<para>
O servidor <command>httpd</command> grava seus arquivos de log geralmente em
<filename>/var/log/apache</filename>, não é possível descrever os arquivos de
logs usados porque tanto seus nomes como conteúdo podem ser personalizados no
arquivo <filename>httpd.conf</filename>.  Mesmo assim, os arquivos de logs
encontrados na instalação padrão do <command>Apache</command> são os seguintes:
</para>
<itemizedlist>
<listitem>
<para>
<filename>access.log</filename> - Registra detalhes sobre o acesso as páginas
do servidor <command>httpd</command>.
</para>
</listitem>
<listitem>
<para>
<filename>error.log</filename> - Registra detalhes saber erros de acesso as
páginas ou erros internos do servidor.
</para>
</listitem>
<listitem>
<para>
<filename>agent.log</filename> - Registra o nome do navegador do cliente (campo
<replaceable>UserAgent</replaceable> do cabeçalho http).
</para>
</listitem>
</itemizedlist>
<para>
Mais referências podem ser encontradas em <xref linkend="s-apache-log"/>.  Um
bom programa para geração de estatísticas de acesso com gráficos é o <xref
linkend="s-apache-log-webalizer"/>.
</para>
</section>

<section id="s-apache-install"><title>Instalação</title>
<para>
<literal>apt-get install apache apache-doc</literal>
</para>
<para>
(o pacote <systemitem role="package">apache-doc</systemitem> contém a
documentação de referencia do <command>Apache</command>, é recomendável
instala-lo se estiver curioso e deseja entender melhor seu funcionamento ou
consultar diretivas).
</para>
</section>

<section id="s-apache-rodando"><title>Iniciando o servidor/reiniciando/recarregando a configuração</title>
<para>
O <command>Apache</command> pode ser executado tanto como um servidor
<emphasis>Inetd</emphasis> ou como um <emphasis>Daemon</emphasis>.  A
inicialização de programas pelo <emphasis>Inetd</emphasis> é uma boa estratégia
quando você precisa de um controle de acesso básico (o fornecido pelo
<command>tcpd</command>), e o serviço é pouco usado na máquina.
</para>
<para>
A segurança de um serviço iniciado pelo <command>inetd</command> pode ser
substituída e melhorada por um firewall bem configurado, garantindo facilidades
extras como um relatório de tráfego para a porta do servidor web, por exemplo.
Mesmo assim se o servidor <command>Apache</command> estiver rodando como daemon
e estiver ocioso, ele será movido para swap liberando a memória RAM para a
execução de outros programas.
</para>
<para>
Neste capítulo será assumido seu funcionamento do <command>Apache</command>
como Daemon, que é o método de funcionamento recomendado para sites de grande
tráfego onde ele é freqüentemente requisitado e considerado um serviço crítico.
</para>
<para>
O método padrão para iniciar programas como daemons na
<command>Debian</command> é através dos diretórios
<filename>/etc/rc?.d</filename>.  Cada diretório deste contém os programas que
serão executados/interrompidos no nível de execução "?"
(<filename>rc1.d/</filename>, <filename>rc2.d/</filename> ...).  O conteúdo
destes diretórios são links para os scripts originais em
<filename>/etc/init.d/programa</filename>, o nosso programa alvo é
<filename>/etc/init.d/apache</filename>.  O
<filename>/etc/init.d/apache</filename> aceita os seguintes parâmetros:
</para>
<itemizedlist>
<listitem>
<para>
<literal>start</literal> - Inicia o <command>Apache</command>
</para>
</listitem>
<listitem>
<para>
<literal>stop</literal> - Finaliza o <command>Apache</command>
</para>
</listitem>
<listitem>
<para>
<literal>restart</literal> - Reinicia o <command>Apache</command>, efetuando
uma pausa de 5 segundos entre a interrupção do seu funcionamento e reinicio.
</para>
</listitem>
<listitem>
<para>
<literal>reload</literal> - Recarrega os arquivos de configuração do
<literal>Apache</literal>, as alterações entram em funcionamento imediatamente.
</para>
</listitem>
<listitem>
<para>
<literal>reload-modules</literal> - Recarrega os módulos.  Basicamente é feito
um restart no servidor.
</para>
</listitem>
<listitem>
<para>
<literal>force-reload</literal> - Faz a mesma função que o reload
</para>
</listitem>
</itemizedlist>
<para>
Para reiniciar o <command>Apache</command> usando o
<filename>/etc/init.d/apache</filename>, digite:
</para>
<para>
./etc/init.d/apache restart
</para>
<para>
ou
</para>
<para>
<literal>cd /etc/init.d;./apache restart</literal>
</para>
<para>
Na realidade, o que o <filename>/etc/init.d/apache</filename> faz é interagir
diretamente com o shell script <command>apachectl</command>.
</para>
<para>
O <command>apachectl</command> recebe os parâmetros enviados pelo usuário e
converte para sinais que serão enviados para o binário
<command>apache</command>.  Da mesma forma ele verifica os códigos de saída do
<command>apache</command> e os transforma em mensagens de erro legíveis para o
usuário comum.  Os seguintes comandos são aceitos pelo
<command>apachectl</command>:
</para>
<itemizedlist>
<listitem>
<para>
<literal>httpd-server/start</literal> - Inicia o <command>Apache</command>
</para>
</listitem>
<listitem>
<para>
<literal>stop</literal> - Finaliza o <command>Apache</command> (enviando um
sinal TERM)
</para>
</listitem>
<listitem>
<para>
<literal>restart</literal> - Reinicia o <command>Apache</command> (enviando um
sinal HUP)
</para>
</listitem>
<listitem>
<para>
<literal>graceful</literal> - Recarrega os arquivos de configuração do
<command>Apache</command> (enviando um sinal USR1)
</para>
</listitem>
<listitem>
<para>
<literal>fullstatus</literal> - Mostra o status completo do servidor
<command>Apache</command> (requer o <command>lynx</command> e o módulo
<emphasis>mod_status</emphasis> carregado).
</para>
</listitem>
<listitem>
<para>
<literal>status</literal> - Mostra o status do processo do servidor
<command>Apache</command> (requer o <command>lynx</command> e o módulo
<emphasis>mod_status</emphasis> carregado).
</para>
</listitem>
<listitem>
<para>
<literal>configtest</literal> - Verifica se a sintaxe dos arquivos de
configuração está OK (executa um <literal>apache -t</literal>).
</para>
</listitem>
</itemizedlist>
</section>

<section id="s-apache-opcoescmd"><title>Opções de linha de comando</title>
<itemizedlist>
<listitem>
<para>
<literal>-D nome</literal> - define um nome que será usado na diretiva
&lt;IfDefine nome&gt;.
</para>
</listitem>
<listitem>
<para>
<literal>-d diretório</literal> - especifica o diretório
<emphasis>ServerRoot</emphasis> (substitui o do arquivo de configuração).
</para>
</listitem>
<listitem>
<para>
<literal>-f arquivo</literal> - especifica um arquivo
<emphasis>ServerConfigFile</emphasis> alternativo.
</para>
</listitem>
<listitem>
<para>
<literal>-C "diretiva"</literal> - processa a diretiva antes de ler os arquivo
de configuração.
</para>
</listitem>
<listitem>
<para>
<literal>-c "diretiva"</literal> - processa a diretiva depois de ler os
arquivos de configuração.
</para>
</listitem>
<listitem>
<para>
<literal>-v</literal> - mostra a versão do programa.
</para>
</listitem>
<listitem>
<para>
<literal>-V</literal> - mostra opções usadas na compilação do
<command>Apache</command>.
</para>
</listitem>
<listitem>
<para>
<literal>-h</literal> - Mostra o help on-line do programa
</para>
</listitem>
<listitem>
<para>
<literal>-l</literal> - lista módulos compilados junto com o Apache (embutidos)
</para>
</listitem>
<listitem>
<para>
<literal>-L</literal> - lista diretivas de configurações disponíveis
</para>
</listitem>
<listitem>
<para>
<literal>-S</literal> - Mostra configurações de Virtual Hosting
</para>
</listitem>
<listitem>
<para>
<literal>-t</literal> - executa a checagem de sintaxe nos arquivos de
configuração do Apache (incluindo a checagem da diretiva
<emphasis>DocRoot</emphasis>).
</para>
</listitem>
<listitem>
<para>
<literal>-T</literal> - executa a checagem de sintaxe nos arquivos de
configuração do <command>Apache</command> (menos da diretiva
<emphasis>DocRoot</emphasis>).
</para>
</listitem>
</itemizedlist>
</section>

</section>

<section id="s-apache-port"><title>Configurando a porta padrão do Apache</title>
<para>
Use a diretiva <emphasis>Port</emphasis> para configurar a porta padrão que o
<command>Apache</command> receberá requisições por padrão.  A diretiva
<emphasis>Listen</emphasis> também é usada para ajustar o endereço/portas
alternativas (usadas também em <literal>Virtual Hosts</literal>) e substituirá
as definições de <emphasis>Port</emphasis>(veja <xref
linkend="s-apache-listen"/> para detalhes).
</para>
<para>
<emphasis role="strong">OBS:</emphasis>: Somente uma diretiva
<emphasis>Port</emphasis> e um argumento poderão ser especificados.  Para mais
controle sobre as portas do sistema use a diretiva <emphasis>Listen</emphasis>.
</para>
</section>

<section id="s-apache-adicpagina"><title>Adicionando uma página no Apache</title>
<para>
Existem dois tipos de páginas que podem ser adicionadas ao
<command>Apache</command>: a página raíz e sub-páginas.
</para>
<variablelist>
<varlistentry>
<term><emphasis>Página Raíz</emphasis></term>
<listitem>
<para>
A página raíz é especificada através da diretiva
<emphasis>DocumentRoot</emphasis> e será mostrada quando se entrar no domínio
principal, como <filename>http://www.guiafoca.org</filename>.  Na configuração
padrão do <command>Apache</command>, <emphasis>DocumentRoot</emphasis> aponta
para o diretório <filename>/var/www</filename>.  Este diretório será assumido
como <emphasis role="strong">raíz</emphasis> caso os diretórios não sejam
iniciados por uma <filename>/</filename>:
</para>
<itemizedlist>
<listitem>
<para>
<filename>home/focalinux</filename> - Aponta para
<filename>/var/www/home/focalinux</filename>
</para>
</listitem>
<listitem>
<para>
<filename>/home/focalinux</filename> - Aponta para
<filename>/home/focalinux</filename>
</para>
</listitem>
</itemizedlist>
<para>
Este diretório deve conter um arquivo de índice válido (especificado pela
diretiva <emphasis>DocumentIndex</emphasis> no <filename>srm.conf</filename>) e
permissões de acesso válidas no arquivo <filename>access.conf</filename> para
autorizar o acesso as páginas em <filename>/var/www</filename> (veja <xref
linkend="s-apache-acesso-restr"/> para detalhes).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Sub-páginas</term>
<listitem>
<para>
Sub páginas são armazenadas abaixo do diretório da <emphasis>Página
raíz</emphasis>, como <filename>http://www.guiafoca.org/download</filename>.
Elas podem ser um subdiretório da página principal em
<filename>/var/www</filename> ou serem criadas através da diretiva
<emphasis>Alias</emphasis> no arquivo <filename>srm.conf</filename>.  Caso seja
um sub-diretório, as permissões de acesso de <filename>/var/www</filename>
serão herdadas para este subdiretório, mas também poderão ser modificadas com a
especificação de uma nova diretiva de acesso.
</para>
<para>
Através da diretiva <emphasis>Alias</emphasis> a página pode estar localizada
em outro diretório do disco (até mesmo outro sistema de arquivos) e as
permissões de acesso deverão ser definidas para aquela página.  Para criar um
endereço <filename>http://www.guiafoca.org/iniciante</filename> que aponta para
o diretório <filename>/home/focalinux/download/iniciante</filename> no disco
local, basta usar a seguinte diretiva no <filename>srm.conf</filename>:
</para>
<screen>
Alias /iniciante /home/focalinux/download/iniciante
</screen>
<para>
Pode ser necessário permitir o acesso a nova página caso o servidor tenha uma
configuração restritiva por padrão (veja <xref
linkend="s-apache-acesso-restr"/> para detalhes).  Após isto, faça o servidor
<command>httpd</command> re-ler os arquivos de configuração ou reinicia-lo.
Após isto, a página <filename>/home/focalinux/download/iniciante</filename>
estará acessível via <filename>http://www.guiafoca.org/iniciante</filename>.
</para>
<para>
<emphasis role="strong">OBS:</emphasis> Caso inclua uma <filename>/</filename>
no diretório que será acessível via URL, o endereço somente estará disponível
caso você entre com <filename>/</filename> no final da URL:
</para>
<screen>
Alias /doc/ /usr/doc/
</screen>
<para>
O diretório <filename>/doc</filename> somente poderá ser acessado usando
<filename>http://www.guiafoca.org/doc/</filename>, o uso de
<filename>http://www.guiafoca.org/doc</filename> retornará uma mensagem de URL
não encontrada.
</para>
</listitem>
</varlistentry>
</variablelist>
</section>

<section id="s-apache-bindaddress"><title>Configurando as interfaces que o Apache atenderá</title>
<para>
A diretiva <emphasis>BindAddress</emphasis> é usada para especificar endereços
IP das interfaces ou endereços FQDN que o <command>Apache</command> responderá
requisições.  Mais de um endereço podem ser especificados separados por
espaços.  Caso não seja definido, o <command>Apache</command> assumirá o valor
"*" (atenderá requisições vindas de qualquer interface).
</para>
<para>
<emphasis role="strong">OBS1:</emphasis> - É permitido usar somente uma
diretiva <emphasis>BindAddress</emphasis>.  A diretiva
<emphasis>Listen</emphasis> deverá ser usada se desejar mais controle sobre as
portas do servidor web.  Veja <xref linkend="s-apache-listen"/> para detalhes.
</para>
<para>
<emphasis role="strong">OBS2:</emphasis> - As interfaces especificadas pela
diretiva <emphasis>Listen</emphasis> substituirá as especificadas em
<emphasis>BindAddress</emphasis>.
</para>
<para>
Exemplo:
</para>
<itemizedlist>
<listitem>
<para>
<literal>BindAddress 192.168.1.1</literal> - Especifica que os usuários da
faixa de rede <filename>192.168.1.*</filename> terão acesso ao servidor
<command>httpd</command>.  Isto assume que a máquina possui o endereço
<filename>192.168.1.1</filename> em sua interface de rede interna.
</para>
</listitem>
<listitem>
<para>
<literal>BindAddress *</literal> - Atenderá requisições vindas de qualquer
interface de rede.
</para>
</listitem>
</itemizedlist>
</section>

<section id="s-apache-listen"><title>Especificando endereços/portas adicionais (a diretiva <emphasis>Listen</emphasis>)</title>
<para>
A diretiva <emphasis>Listen</emphasis> é usada para se ter um controle maior
sobre a especificação de endereços/portas alternativas que o servidor web
esperará por requisições externas.  Esta diretiva é muito usada na construção
de <emphasis>Virtual Hosts</emphasis>.  Esta diretiva pode substituir
completamente as diretivas <emphasis>Port</emphasis> e
<emphasis>BindAddress</emphasis>.  Podem ser usados o número da porta, ou o par
<literal>endereço:porta</literal>:
</para>
<screen>
Listen 192.168.1.1:80
Listen 192.168.7.1:81
Listen 60000
</screen>
<para>
O endereço que deverá ser usado é o da interface de rede (assim como na
diretiva <emphasis>BindAddress</emphasis>).  No exemplo acima, o servidor
<command>httpd</command> esperará por requisições vindas de
<filename>192.168.1.*</filename> na porta 80 e também 60000, e requisições
vindas de 192.168.7.1 na porta 81 e também 60000.
</para>
</section>

<section id="s-apache-acesso"><title>Especificando opções/permissões para as páginas</title>
<para>
As opções de restrição podem tanto ser especificadas nas diretivas
&lt;Directory&gt;, &lt;Location&gt; ou &lt;Files&gt; quanto nos arquivos
<filename>.htaccess</filename> (ou outro nome de arquivo de controle de acesso
especificado pela opção <emphasis>AccessFileName</emphasis> do arquivo de
configuração do <command>Apache</command>).  Cada diretiva de acesso é
especificada entre &lt;tags&gt; e devem ser fechadas com &lt;/tag&gt; (como na
linguagem HTML).  As seguintes diretivas de acesso são válidas no
<command>Apache</command>:
</para>
<variablelist>
<varlistentry>
<term>Directory</term>
<listitem>
<para>
As restrição afetará o diretório no disco especificado, conseqüentemente a
página armazenada nele.  Por exemplo:
</para>
<screen>
&lt;Directory /var/www&gt;
 Order deny,allow
 deny from all
 allow from 10.1.0.1
&lt;Directory&gt;
</screen>
<para>
O acesso ao diretório <filename>/var/www</filename> será permitido somente ao
computador com o endereço IP <literal>10.1.0.1</literal>.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>DirectoryMatch</term>
<listitem>
<para>
Funciona como a diretiva &lt;Directory&gt; mas trabalha com expressões
regulares como argumento.  Por exemplo:
</para>
<screen>
&lt;DirectoryMatch "^/www/.*"&gt;
 Order deny,allow
 deny from all
&lt;DirectoryMatch&gt;
</screen>
<para>
Bloqueará o acesso ao diretório <filename>/www</filename> e sub-diretórios
dentro dele.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Files</term>
<listitem>
<para>
As restrições afetarão os arquivos do disco que conferem com o especificado.  É
possível usar os coringas <emphasis>?</emphasis> e <emphasis>*</emphasis> como
no shell.  Também podem ser usadas expressões regulares especificando um "~"
após <literal>Files</literal> e antes da expressão.  Por exemplo:
</para>
<screen>
&lt;Files *.txt&gt;
 Order deny,allow
 deny from all
&lt;/Files&gt;
</screen>
<para>
Bloqueia o acesso a todos os arquivos com a extensão <filename>.txt</filename>
</para>
<screen>
&lt;Files ~ "\.(gif|jpe?g|bmp|png)$"&gt;
 Order deny,allow
&lt;/Files&gt;
</screen>
<para>
Bloqueia o acesso a arquivos <filename>gif, jpg, jpeg, bmp, png</filename>
(note que o "~" ativa o modo de interpretação de expressões regulares).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>FilesMatch</term>
<listitem>
<para>
Permite usar expressões regulares na especificação de arquivos (equivalente a
diretiva &lt;Files ~ "expressão"&gt;).  Por exemplo:
</para>
<screen>
&lt;FilesMatch "\.(gif|jpe?g|bmp|png)$"&gt;
 Order deny,allow
&lt;/FilesMatch&gt;
</screen>
<para>
Bloqueia o acesso a arquivos <filename>gif, jpg, jpeg, bmp, png</filename>.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Location</term>
<listitem>
<para>
As restrições afetarão o diretório base especificado na URL e seus
sub-diretórios.  Por exemplo:
</para>
<screen>
&lt;Location /security&gt;
 Order allow,deny
&lt;/Location&gt;
</screen>
<para>
Bloqueia o acesso de todos os usuários ao diretório
<filename>/security</filename> da URL (a explicação porque o acesso é bloqueado
neste caso será explicado em <xref linkend="s-apache-acesso-restr-autor"/>).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>LocationMatch</term>
<listitem>
<para>
Idêntico a diretiva &lt;Location&gt; mas trabalha com expressões regulares.
Por exemplo:
</para>
<screen>
&lt;LocationMatch "/(extra|special)/data"&gt;
 Order deny,allow
 deny from all
&lt;/LocationMatch&gt;
</screen>
<para>
Bloqueará URLs que contém a substring "/extra/data" ou "/special/data".
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
O uso das diretivas &lt;Directory&gt; e &lt;Files&gt; é apropriada quando você
deseja trabalhar com permissões a nível de diretórios/arquivos no disco local
(o controle do proxy também é feito via &lt;Directory&gt;), o uso da diretiva
&lt;Location&gt; é adequado para trabalhar com permissões a nível de URL.  A
ordem de processamento das diretivas de acesso são processadas é a seguinte:
</para>
<orderedlist numeration="arabic">
<listitem>
<para>
A diretiva &lt;Directory&gt; (com exceção de &lt;DirectoryMatch&gt;) e os
arquivos <filename>.htaccess</filename> são processados simultaneamente.  As
definições dos arquivos <filename>.htaccess</filename> substituem as de
&lt;Directory&gt;)
</para>
</listitem>
<listitem>
<para>
Expressões regulares de &lt;DirectoryMatch&gt;, &lt;Directory&gt;.
</para>
</listitem>
<listitem>
<para>
&lt;Files&gt; e &lt;FilesMatch&gt; são processados simultaneamente.
</para>
</listitem>
<listitem>
<para>
&lt;Location&gt; e &lt;LocationMatch&gt; são processados simultaneamente.
</para>
</listitem>
</orderedlist>
<para>
Normalmente é encontrado a opção <emphasis>Options</emphasis> dentro de uma das
diretivas acima, a função desta diretiva é controlar os seguintes aspectos da
listagem de diretórios:
</para>
<variablelist>
<varlistentry>
<term>All</term>
<listitem>
<para>
Todas as opções são usadas exceto a <literal>MultiViews</literal>.  É a padrão
caso a opção <emphasis>Options</emphasis> não seja especificada.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ExecCGI</term>
<listitem>
<para>
Permite a execução de scripts CGI.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>FollowSymLinks</term>
<listitem>
<para>
O servidor seguirá links simbólicos neste diretório (o caminho não é
modificado).  Esta opção é ignorada caso apareça dentro das diretivas
&lt;Location&gt;, &lt;LocationMatch&gt; e &lt;DirectoryMatch&gt;.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Includes</term>
<listitem>
<para>
É permitido o uso de includes no lado do servidor.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>IncludesNOEXEC</term>
<listitem>
<para>
É permitido o uso de includes do lado do servidor, mas o comando
<literal>#exec</literal> e <literal>#include</literal> de um script CGI são
desativados.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Indexes</term>
<listitem>
<para>
Se não existir um arquivo especificado pela diretiva &lt;DirectoryIndex&gt; no
diretório especificado, o servidor formatará automaticamente a listagem ao
invés de gerar uma resposta de acesso negado.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>MultiViews</term>
<listitem>
<para>
Permite o uso da Negociação de conteúdo naquele diretório.  A negociação de
conteúdo permite o envio de um documento no idioma requisitado pelo navegador
do cliente.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>SymLinksIfOwnerMatch</term>
<listitem>
<para>
O servidor somente seguirá links simbólicos se o arquivo ou diretório alvo
tiver como dono o mesmo user ID do link.  Esta opção é ignorada caso apareça
dentro das diretivas &lt;Location&gt;, &lt;LocationMatch&gt; e
&lt;DirectoryMatch&gt;.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
Múltiplos parâmetros para <emphasis>Options</emphasis> podem ser especificados
através de espaços.
</para>
<para>
<emphasis role="strong">OBS1</emphasis>: A opção Options não tem efeito dentro
da diretiva FILES.
</para>
<para>
<emphasis role="strong">OBS2</emphasis>: Tanto faz usar maiúsculas quanto
minúsculas nas diretivas de configuração, opções e parâmetros de configuração
do <command>Apache</command>, a capitalização apenas ajuda a leitura e
interpretação: SymLinksIfOwnerMatch (LinksSimbólicosSeDonoConferir).
</para>
<para>
As opções especificadas para o diretório afetam também seus sub-diretórios, a
não ser que sejam especificadas opções separadas para o sub-diretório:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes FollowSymLinks
&lt;/Directory&gt;
</screen>
<para>
Ao acessar o diretório <filename>/var/www/focalinux</filename>, as permissões
usadas serão de <filename>/var/www</filename>, ao menos que uma diretiva
&lt;Directory&gt; ou &lt;Location&gt; seja especificada:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes FollowSymLinks
&lt;/Directory&gt;

&lt;Directory /var/www/focalinux&gt;
 Options Includes
&lt;/Directory&gt;
</screen>
<para>
As opções e restrições de acesso de <filename>/var/www/focalinux</filename>
serão EXATAMENTE as especificadas no bloco da diretiva &lt;Directory
/var/www/focalinux&gt; e somente os <emphasis>includes</emphasis> serão
permitidos.  Para adicionar ou remover uma opção individual definidas por
diretivas anteriores, podem ser usado os sinais "+" ou "-", por exemplo:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes FollowSymLinks
&lt;/Directory&gt;

&lt;Directory /var/www/focalinux&gt;
 Options +Includes -Indexes
&lt;/Directory&gt;
</screen>
<para>
As opções <emphasis>Indexes</emphasis> e <emphasis>FollowSymLinks</emphasis>
são definidas para o diretório <filename>/var/www</filename>, então as
permissões do diretório <filename>/var/www/focalinux</filename> serão
<emphasis>FollowSymLinks</emphasis> (do diretório
<filename>/web/docs</filename>) e <emphasis>Includes</emphasis> (adicionada) e
o parâmetro <emphasis>Indexes</emphasis> não terá efeito neste diretório.
</para>
<para>
É permitido fazer um aninhamento das diretivas &lt;Directory&gt; e
&lt;Files&gt;:
</para>
<screen>
&lt;Directory /var/www&gt;
 Order allow,deny
 allow from all

 &lt;Files LEIAME-DONO.txt&gt;
  Order deny,allow
  deny from all
 &lt;/Files&gt;

&lt;/Directory&gt;
</screen>
<para>
Neste caso, somente os arquivos <filename>LEIAME-DONO.txt</filename> existentes
no diretório <filename>/var/www</filename> e seus sub-diretórios serão
bloqueados.
</para>
<para>
Se a diretiva &lt;Files&gt; for usada fora de uma estrutura &lt;Directory&gt;,
ela terá efeito em todos os arquivos disponibilizados pelo servidor.  Este é
excelente método para proteger os arquivos de acesso, senhas e grupos, conforme
será explicado mais adiante.
</para>
<para>
Qualquer outro tipo de aninhamento de diretivas resultará em um erro de
configuração ao se tentar carregar/recarregar o <command>Apache</command>.  Um
exemplo de diretiva incorreta:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes FollowSymLinks

 &lt;Directory /var/www/focalinux&gt;
  Options +Includes -Indexes
 &lt;/Directory&gt;

&lt;/Directory&gt;
</screen>
<para>
O correto é:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes FollowSymLinks
&lt;/Directory&gt;

&lt;Directory /var/www/focalinux&gt;
 Options +Includes -Indexes
&lt;/Directory&gt;
</screen>
<para>
Espero que tenha observado o erro no exemplo acima.
</para>
<para>
<emphasis role="strong">OBS1</emphasis>: Você pode verificar se a configuração
do apache está correta digitando <literal>apache -t</literal> como usuário
root, se tudo estiver correto com suas configurações ele retornará a mensagem:
"Syntax OK".
</para>
<para>
<emphasis role="strong">OBS2</emphasis>: Se <emphasis>Options</emphasis> não
for especificado, o padrão será permitir tudo exceto
<emphasis>MultiViews</emphasis>.
</para>
<para>
<emphasis role="strong">OBS3</emphasis>: Qualquer restrição afetará o diretório
atual e todos os seus sub-diretórios!  Defina permissões de sub-diretórios
específicos separadamente caso precise de um nível de acesso diferente.  Veja
também a seção sobre arquivos OverRide (<filename>.htaccess</filename>) para
detalhes sobre este tipo de arquivo.
</para>
<para>
<emphasis role="strong">OBS4</emphasis>: A diretiva de acesso "&lt;Directory
/&gt;" não afetará outros sistemas de arquivos montados dentro de seus
subdiretórios.  Caso uma diretiva de acesso padrão não seja especificada para
outros sistemas de arquivos, o acesso será automaticamente negado.
</para>
</section>

<section id="s-apache-acesso-restr"><title>Restrições de Acesso</title>
<para>
A restrição de acesso do <command>Apache</command> é feita através de
<emphasis>Autorização</emphasis> (<xref
linkend="s-apache-acesso-restr-autor"/>) e <emphasis>Autenticação</emphasis>
(<xref linkend="s-apache-acesso-restr-auth"/>).  Através da
<emphasis>autorização</emphasis>, é checado se o endereço/rede especificada tem
ou não permissão para acessar a página.  A <emphasis>autenticação</emphasis>
requer que seja passado nome e senha para garantir acesso a página.  Os métodos
de <emphasis>Autorização</emphasis> e <emphasis>Autenticação</emphasis> podem
ser combinados como veremos mais adiante.
</para>
<section id="s-apache-acesso-restr-autor"><title>Autorização</title>
<para>
A restrição de acesso por autorização (controlado pelo módulo
<filename>mod_access</filename>), permite ou não o acesso ao cliente de acordo
com o endereço/rede especificada.  As restrições afetam também os
sub-diretórios do diretório alvo.  Abaixo um exemplo de restrição de acesso que
bloqueia o acesso de qualquer host que faz parte do domínio
<emphasis>.spammers.com.br</emphasis> a URL
<filename>http://servidor/teste</filename>:
</para>
<screen>
&lt;Location /teste&gt;
 Option Indexes
 Order allow,deny
 allow from all
 deny from .spammers.com.br
&lt;/Location&gt;
</screen>
<para>
A opção <literal>Option</literal> foi explicada acima, seguem as explicações
das outras diretivas:
</para>
<variablelist>
<varlistentry>
<term>Order</term>
<listitem>
<para>
Especifica em que ordem as opções de acesso <emphasis>allow/deny</emphasis>
serão pesquisadas.  Caso não seja especificada, o padrão será
<emphasis>deny/allow</emphasis>.  Note que a ordem de pesquisa de
<emphasis>allow</emphasis> e <emphasis>deny</emphasis> é a inversa da
especificada.  A diretiva <emphasis>Order</emphasis> aceita os seguintes
valores:
</para>
<itemizedlist>
<listitem>
<para>
<literal>deny,allow</literal> - Esta é a padrão, significa um servidor mais
restritivo; a diretiva <emphasis>allow</emphasis> é processada primeiro e
somente depois a diretiva <emphasis>deny</emphasis>.  Caso nenhuma diretiva
allow e deny forem especificadas ou não conferirem, <emphasis
role="strong">PERMITE TUDO</emphasis> como padrão.
</para>
</listitem>
<listitem>
<para>
<literal>allow,deny</literal> - Significa um servidor mais permissivo, a opção
<emphasis>deny</emphasis> é processada primeiro e somente depois a opção
<emphasis>allow</emphasis>.  Caso nenhuma diretiva allow e deny for
especificadas ou não conferirem, <emphasis role="strong">BLOQUEIA
TUDO</emphasis> como padrão.
</para>
</listitem>
<listitem>
<para>
<literal>mutual-failure</literal> - Somente permite o acesso se o usuário
receber autorização através da opção <emphasis>allow</emphasis> e <emphasis
role="strong">NÃO</emphasis> ser bloqueado pela opção
<emphasis>deny</emphasis>, caso uma das checagens falhe, o acesso é
imediatamente negado.  É uma opção interessante quando você quer somente
pessoas de um determinado endereço/rede acessando o seu sistema e não estejam
em sua lista negra :-)
</para>
</listitem>
</itemizedlist>
<para>
<emphasis role="strong">ATENÇÃO</emphasis>: É importante saber se a página será
permissiva ou restritiva para escolher a ordem mais adequada ao seu caso,
também leve em consideração a possibilidade do processamento cair na diretiva
de acesso padrão, caso nem a diretiva allow e deny conferiram e estiver usando
a ordem de acesso "allow,deny" ou "deny,allow".  Um sistema mal configurado
neste aspecto poderá trazer sérias conseqüências.
</para>
<para>
É comum em páginas permissivas se definir a seguinte configuração:
</para>
<screen>
Order allow,deny
allow from all
</screen>
<para>
O motivo é que em um grande site, se forem adicionadas mais restrições nesta
página (devido a alguns domínios que tem usuários mal comportados, bloqueio de
acesso a rede do concorrente, potenciais atacantes, etc...), estas deverão ser
lidas antes da diretiva "allow from all" e podem passar desapercebidas ao
administrador e podem simplesmente não funcionar caso a opção
<emphasis>Order</emphasis> não esteja ajustada corretamente (lembre-se, você é
o administrador e a integridade do site depende de sua atenção na escolha da
ordem correta das diretivas de acesso).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>allow from</term>
<listitem>
<para>
Especifica o endereço que terá acesso ao recurso especificado.  A diretiva
<emphasis>allow</emphasis> from aceita os seguintes valores:
</para>
<itemizedlist>
<listitem>
<para>
<literal>all</literal> - O acesso é permitido a todos.
</para>
</listitem>
<listitem>
<para>
um endereço de domínio completo (FQDN).  Por exemplo
<filename>www.debian.org.br</filename>.
</para>
</listitem>
<listitem>
<para>
um endereço de domínio parcial.  Qualquer computador que confira com o inicio
ou fim terá o acesso permitido.  Por exemplo,
<filename>.spammers.com.br</filename>, <filename>.debian.org</filename>.
</para>
</listitem>
<listitem>
<para>
um endereço IP completo, como <literal>192.168.1.1</literal>
</para>
</listitem>
<listitem>
<para>
um endereço IP parcial como <literal>192.168.1.</literal>
</para>
</listitem>
<listitem>
<para>
um par rede/máscara como <literal>10.1.0.0/255.255.0.0</literal> ou
<literal>10.1.0.0/16</literal>, uma faixa de acesso a máquinas de uma mesma
rede pode ser definida facilmente através deste método.
</para>
</listitem>
</itemizedlist>
<para>
<emphasis role="strong">OBS1</emphasis>: É necessário reiniciar o
<command>Apache</command> depois de qualquer modificação em seu arquivo de
configuração (executando <literal>apachectl restart</literal>), ou recarregar
os arquivos de configuração (<literal>apachectl graceful</literal>).
</para>
<para>
<emphasis role="strong">OBS2</emphasis>: Mais de um host pode ser especificado
separando com um espaço:
</para>
<screen>
allow from 192.168. .debian.org.br
</screen>
<para>
Permitirá o acesso de qualquer máquina que o endereço IP confira com
<literal>192.168.*.*</literal> e qualquer computador do domínio
<literal>debian.org.br</literal>
</para>
<para>
<emphasis role="strong">OBS3</emphasis>: Regras baseadas em nomes simples de
hosts (como <literal>www</literal>) não conferirão!  Deverá ser usado o FQDN ou
IP: <literal>www.dominio.com.br</literal>
</para>
<para>
<emphasis role="strong">OBS4</emphasis>: Caso Order não seja especificado,
<emphasis>deny,allow</emphasis> será usado como padrão (ou seja, permitirá tudo
como padrão).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>deny from</term>
<listitem>
<para>
Especifica os endereços que NÃO terão acesso ao recurso especificado.  As
explicações referentes a esta diretiva de acesso são idêntica as de
<emphasis>allow from</emphasis>.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
É recomendável o uso de endereços IP ao invés de endereços DNS e um mecanismo
anti-spoofing no firewall ou código de roteamento, pois ficará mais difícil um
ataque baseado em DNS spoofing, aumentando consideravelmente a segurança de seu
servidor web.
</para>
<para>
<emphasis role="strong">ATENÇÃO</emphasis>: Caso receba erros 403 (acesso
negado) sem bloquear a URL nas diretivas de acesso, uma dos seguintes problemas
pode ser a causa:
</para>
<itemizedlist>
<listitem>
<para>
O servidor Web não tem permissões para acessar/abrir o diretório da página.
Certifique-se que o <emphasis>dono</emphasis> e <emphasis>grupo</emphasis> do
processo <command>Apache</command> (especificado pela diretiva
<emphasis>User</emphasis> e <emphasis>Group</emphasis>) possuem permissões de
acesso àquele diretório.
</para>
</listitem>
<listitem>
<para>
Quando quer fazer uma listagem de arquivos do diretório e não especifica a
opção <literal>Option Indexes</literal> como opção de listagem.
</para>
</listitem>
<listitem>
<para>
Quando não está usando <literal>Option Indexes</literal> para impedir a
listagem de conteúdo do diretório e o não foi encontrado um arquivo de índice
válido dentre os existentes na diretiva <literal>DirectoryIndex</literal> no
diretório atual.
</para>
</listitem>
</itemizedlist>
<para>
Abaixo alguns exemplos de permissões de acesso:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options SymLinksIfOwnerMatch Indexes MultiViews
 Order allow,deny
 allow from all
&lt;/Directory&gt;
</screen>
<para>
Permite o acesso a de qualquer usuário de qualquer lugar (allow from all),
permite também a visualização da listagem formatada de arquivos caso nenhum
arquivo especificado na diretiva <emphasis>DirectoryIndex</emphasis> seja
encontrado (Indexes), permite negociação de conteúdo
(<emphasis>MultiViews</emphasis>) e seguir links caso o dono do arquivo confira
com o nome do link (<emphasis>SymLinksIfOwnerMatch</emphasis>).
</para>
<screen>
&lt;Directory /var/www&gt;
 Options SymLinksIfOwnerMatch Indexes MultiViews
&lt;/Directory&gt;
</screen>
<para>
Tem o mesmo significado da diretiva acima por métodos diferentes; quando
nenhuma opção <emphasis>Order</emphasis> é especificada,
<emphasis>deny,allow</emphasis> é definido como padrão, e como nenhuma opção de
acesso <emphasis>allow/deny</emphasis> foi especificada, o padrão "Order
deny,allow" é usado e permite TUDO como padrão.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 Order deny,allow
 deny from all
&lt;/Directory&gt;
</screen>
<para>
Esta regra acima não tem muita lógica pois restringe o acesso de todos os
usuários ao diretório <filename>/var/www</filename>, ao menos se esta for sua
intenção...
</para>
<screen>
&lt;Location /focalinux&gt;
 Options All
 Order allow,deny
 allow from all
&lt;/Location&gt;
</screen>
<para>
A regra acima permite o acesso a URL
<filename>http://www.servidor.org/focalinux</filename> de qualquer host na
Internet
</para>
<screen>
&lt;Files .htaccess&gt;
 Order deny,allow
 deny from all
&lt;/Files&gt;
</screen>
<para>
Bloqueia o acesso a qualquer arquivo <filename>.htaccess</filename> do sistema
</para>
<screen>
&lt;Files ~ "leiame-(arm|alpha|m68k|sparc|powerpc)\.txt"&gt;
 Order deny,allow
 deny from all
&lt;/Files&gt;
</screen>
<para>
Bloqueia o acesso a qualquer arquivo <filename>leiame-arm.txt</filename>,
<filename>leiame-alpha.txt</filename>, <filename>leiame-m68k.txt</filename>,
<filename>leiame-sparc.txt</filename> e <filename>leiame-powerpc.txt</filename>
fazendo uso de expressões regulares.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 Order mutual-failure
 allow from .dominio.com.br
 deny from lammer.dominio.com.br
&lt;/Directory&gt;
</screen>
<para>
A diretiva acima somente permite acesso ao diretório
<filename>/var/www</filename> de máquinas pertencentes ao domínio
<filename>.dominio.com.br</filename> desde que não seja
<filename>lammer.dominio.com.br</filename>.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes MultiViews
 Order allow,deny
 deny from .com .com.br
 allow from all 
&lt;/Directory&gt;
</screen>
<para>
Bloqueia o acesso ao diretório <filename>/var/www</filename> de computadores
pertencentes aos domínios <emphasis>.com</emphasis> e
<emphasis>.com.br</emphasis>.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options None
 Order deny,allow
 allow from 192.168.1. .guiafoca.org .debian.org
 deny from 200.200.123.
&lt;/Directory&gt;
</screen>
<para>
A regra acima permite o acesso de máquinas da rede
<literal>192.168.1.*</literal>, do domínio <literal>*.guiafoca.org</literal> e
<literal>*.debian.org</literal>, o acesso de máquinas da rede
<literal>200.200.123.*</literal> é bloqueado (nada contra, peguei nesse número
ao acaso :-).
</para>
<para>
Note que a máquina <literal>192.168.4.10</literal> terá acesso LIVRE a regra
acima, pois não conferirá nem com <emphasis>allow</emphasis> nem com
<emphasis>deny</emphasis>, então o processamento cairá na diretiva padrão de
<emphasis>deny,allow</emphasis>, que neste caso permite o acesso caso nem
<emphasis>allow</emphasis> e <emphasis>deny</emphasis> conferiram com o padrão.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options None
 Order allow,deny
 allow from 192.168.1. .cipsga.org.br .debian.org
 deny from 200.200.123.
&lt;/Directory&gt;
</screen>
<para>
A regra acima é idêntica a anterior somente com a mudança da opção
<emphasis>Order</emphasis>.  Bloqueia o acesso de máquinas da rede
<literal>200.200.123.*</literal> e permite o acesso de máquinas da rede
<literal>192.168.1.*</literal>, do domínio <literal>*.cipsga.org.br</literal> e
<literal>*.debian.org</literal>.
</para>
<para>
Note que a máquina <literal>192.168.4.10</literal> terá acesso BLOQUEADO a
regra acima, pois não conferirá nem com <emphasis>allow</emphasis> nem com
<emphasis>deny</emphasis>, então o processamento cairá na diretiva padrão de
<emphasis>allow,deny</emphasis> que neste caso bloqueia o acesso.
</para>
</section>

<section id="s-apache-acesso-restr-auth"><title>Autenticação</title>
<para>
Através da <emphasis>autenticação</emphasis> (controlado pelo módulo
<filename>mod_auth</filename>) é possível especificar um
<emphasis>nome</emphasis> e <emphasis>senha</emphasis> para acesso ao recurso
solicitado.  As senhas são gravadas em formato criptografado usando
<emphasis>Crypto</emphasis> ou <emphasis>MD5</emphasis> (conforme desejado).  O
arquivo de senhas pode ser centralizado ou especificado individualmente por
usuário, diretório ou até mesmo por arquivo acessado.
</para>
<section id="s-apache-acesso-restr-auth-arqsenha"><title>Criando um arquivo de Senhas</title>
<para>
O arquivo de senhas pode ser criado e mantido através do uso de 3 utilitários:
<command>htpasswd</command>, <command>htdigest</command> e
<command>dbmmanage</command>:
</para>
<section id="s-apache-acesso-restr-auth-arqsenha-htpasswd"><title>htpasswd</title>
<para>
Este é usado para criar o arquivo de senhas.  Para criar um banco de dados com
o nome <filename>senhas</filename> para o usuário
<replaceable>convidado</replaceable>, é usada a seguinte sintaxe:
</para>
<para>
<literal>htpasswd -c -m senhas convidado</literal>
</para>
<para>
Você será perguntado por uma senha para o usuário
<replaceable>convidado</replaceable> e para redigita-la.  A opção "-c" indica
que deverá ser criado um arquivo, a opção "-m" indica a utilização de senhas
criptografadas usando o algoritmo <emphasis>MD5</emphasis>, que garante maior
segurança que o método <emphasis>Crypto</emphasis>.  A senha pode ser
especificada diretamente na linha de comando através da opção "-b" (isto é um
ótimo recurso para utilização em shell scripts ou programas CGI de integração
com o navegador).
</para>
<para>
<literal>htpasswd -b -d senhas chefe abcdef</literal>
</para>
<para>
No exemplo acima, uma senha de alta segurança será introduzida no banco de
dados <filename>senhas</filename> tornando impossível o acesso a página do
usuário :-)
</para>
<para>
Note que esta senha foi cadastrada usando o algoritmo de criptografia Crypto
(opção -d).  O algoritmo <emphasis>SHA</emphasis> também pode ser usado como
alternativa, através da opção "-s".  Para modificar a senha do usuário
convidado, basta usar a mesma sintaxe (sem a opção "-c" que é usada para criar
um novo arquivo):
</para>
<para>
<literal>htpasswd -m senhas convidado</literal>
</para>
<para>
ou
</para>
<para>
<literal>htpasswd -b -m senhas convidado nova_senha</literal>
</para>
<para>
Opcionalmente você pode especificar a opção "-d" para atualizar também o
formato da senha para <emphasis>Crypto</emphasis>.  Podem existir senhas de
criptografias mistas (<emphasis>SHA, Crypto, MD5</emphasis>) no mesmo arquivo
sem nenhum problema.
</para>
<para>
A mudança do formato de senhas é útil quando se deseja aumentar o nível de
segurança oferecido por um melhor sistema ou para manter a compatibilidade com
alguns scripts/programas que compartilhem o arquivo de senhas.
</para>
</section>

<section id="s-apache-acesso-restr-auth-arqsenha-htdigest"><title>htdigest e dbmmanage</title>
<para>
Estes são idênticos ao <command>htpasswd</command>, a diferença é que o
<command>htdigest</command> permite criar/manter um arquivo de senhas usando a
autenticação Digest, enquanto o <command>dbmmanage</command> permite manter o
banco de dados de senhas em um arquivo <filename>DB, DBM, GDBM</filename> e
<filename>NDBM</filename>, formatos conhecidos pelo Perl.
</para>
</section>

</section>

<section id="s-apache-acesso-restr-auth-usuarios"><title>Autenticação através de usuários</title>
<para>
Através deste método é possível especificar que usuários terão acesso ao
recurso definido, usando senhas de acesso individuais criptografadas usando um
dos utilitários da seção anterior.  Para restringir o acesso ao endereço
<filename>http://servidor.org/teste</filename>:
</para>
<screen>
&lt;Location /teste&gt;
 AuthName "Acesso a página do Foca Linux"
 AuthType basic
 AuthUserFile /home/gleydson/SenhaUsuario
# AuthGroupFile /home/users/SenhaGrupo
 Require valid-user
&lt;/Location&gt;
</screen>
<para>
Ao tentar acessar o endereço <filename>http://servidor/teste</filename>, será
aberta uma janela no navegador com o título <emphasis>Enter username for Acesso
a página do Foca Linux at servidor.org</emphasis>, a diretiva <emphasis>Require
valid-user</emphasis> definem que o usuário e senha digitados devem existir no
arquivo especificado por <emphasis>AuthUserFile</emphasis> para que o acesso
seja garantido.  Uma explicação de cada opção de acesso usado na autenticação:
</para>
<variablelist>
<varlistentry>
<term>AuthName</term>
<listitem>
<para>
Será o nome que aparecerá na janela de autenticação do seu navegador indicando
qual área restrita está solicitando senha (podem existir várias no servidor,
bastando especificar várias diretivas de restrições).
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>AuthType</term>
<listitem>
<para>
Especifica o método de que o nome e senha serão passados ao servidor.  Este
método de autenticação pode ser <emphasis>Basic</emphasis> ou
<emphasis>Digest</emphasis>
</para>
<itemizedlist>
<listitem>
<para>
<literal>Basic</literal> - Utiliza a codificação <emphasis>base64</emphasis>
para encodificação de nome e senha, enviando o resultado ao servidor.  Este é
um método muito usado e pouco seguro, pois qualquer sniffer instalado em um
roteador pode capturar e descobrir facilmente seu nome e senha.
</para>
</listitem>
<listitem>
<para>
<literal>Digest</literal> - Transmite os dados de uma maneira que não pode ser
facilmente decodificada, incluindo a codificação da área protegida
(especificada pela diretiva <emphasis>AuthName</emphasis>) que possui a
seqüencia de login/senha válida.  A diferença deste método é que você precisará
de arquivos de senhas diferentes para cada área protegida especificada por
<emphasis>AuthName</emphasis> (também chamada de Realm).
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>AuthUserFile</term>
<listitem>
<para>
É o arquivo gerado pelo utilitário <command>htpasswd</command> que contém a
senha correspondente ao usuário
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>AuthGroupFile</term>
<listitem>
<para>
É um arquivo texto que contém o nome do grupo, dois pontos (":") e o nome dos
usuários que podem ter acesso ao recurso, separados por vírgulas.  No exemplo
acima ele se encontra comentado, mas a seguir encontrará exemplos que explicam
em detalhes o funcionamento desta diretiva.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>Require</term>
<listitem>
<para>
Especifica que usuários podem ter acesso ao diretório.  Podem ser usadas uma
das 3 sintaxes:
</para>
<itemizedlist>
<listitem>
<para>
<literal>Require user usuário1 usuário2 usuário3</literal> - Somente os
usuários especificados são considerados válidos para ter acesso ao diretório.
</para>
</listitem>
<listitem>
<para>
<literal>Require group grupo1 grupo2 grupo3</literal> - Somente os usuários dos
grupos especificados são considerados válidos para terem acesso ao diretório.
Esta diretiva é útil quando deseja que somente alguns usuários de determinado
grupo tenham acesso ao recurso (por exemplo, usuários do grupo admins).
</para>
</listitem>
<listitem>
<para>
<literal>Require valid-user</literal> - Qualquer usuário válido no banco de
dados de senhas pode acessar o diretório.  É bem útil quando as opções de
acesso especificadas por Require user são muito longas.
</para>
<para>
A opção Require deve ser acompanhado das diretivas
<emphasis>AuthName</emphasis>, <emphasis>AuthType</emphasis> e as diretivas
<emphasis>AuthUserFile</emphasis> e <emphasis>AuthGroupFile</emphasis> para
funcionar adequadamente.
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<para>
<emphasis role="strong">OBS</emphasis>: É necessário reiniciar o
<command>Apache</command> depois de qualquer modificação em seu arquivo de
configuração (<literal>apachectl restart</literal>), ou recarregar os arquivos
de configuração (<literal>apachectl graceful</literal>).  Note que o
<command>apachectl</command> é somente um shell script para interação mais
amigável com o servidor web <command>apache</command>, retornando mensagens
indicando o sucesso/falha no comando ao invés de códigos de saída.
</para>
<para>
Alguns exemplos para melhor assimilação:
</para>
<screen>
&lt;Location /teste&gt;
 AuthName "Acesso a página do Foca Linux"
 AuthType basic
 AuthUserFile /home/gleydson/SenhaUsuario
 Require user gleydson
&lt;/Location&gt;
</screen>
<para>
As explicações são idênticas a anterior, mas somente permite o acesso do
usuário <literal>gleydson</literal> a URL
<filename>http://servidor.org/teste</filename>, bloqueando o acesso de outros
usuários contidos no arquivo <emphasis>AuthUserFile</emphasis>.
</para>
<screen>
&lt;Location /teste&gt;
 AuthName "Acesso a página do Foca Linux"
 AuthType basic
 AuthUserFile /home/gleydson/SenhaUsuario
 Require user gleydson usuario1 usuario2
&lt;/Location&gt;
</screen>
<screen>
&lt;Location /teste&gt;
 AuthName "Acesso a página do Foca Linux"
 AuthType basic
 AuthUserFile /home/gleydson/SenhaUsuario
 Require user gleydson
 Require user usuario1
 Require user usuario2
&lt;/Location&gt;
</screen>
<para>
As 2 especificações acima são equivalentes e permite o acesso aos usuários
<literal>gleydson</literal>, <literal>usuario1</literal> e
<literal>usuario2</literal> a página
<filename>http://servidor.org/teste</filename>.
</para>
</section>

<section id="s-apache-acesso-restr-auth-grupos"><title>Autenticação usando grupos</title>
<para>
Há casos onde existem usuários de um arquivo de senhas que devem ter acesso a
um diretório e outros não, neste caso a diretiva
<emphasis>valid-user</emphasis> não pode ser especificada (porque permitiria o
acesso de todos os usuários do arquivo de senha ao diretório) e uma grande
lista de usuários ficaria bastante complicada de ser gerenciada com vários
usuários na diretiva <emphasis>Require user</emphasis>.
</para>
<para>
Quando existe esta situação, é recomendado o uso de grupos de usuários.  Para
fazer uso desse recurso, primeiro deverá ser criado um arquivo quer armazenará
o nome do <emphasis>grupo</emphasis> e dos usuários pertencente àquele grupo
usando a seguinte sintaxe (vamos chamar este arquivo de
<filename>SenhaGrupo</filename>):
</para>
<screen>
admins: gleydson usuario2
usuarios: usuario1 usuario2 usuario3 gleydson
</screen>
<para>
Agora adaptamos o exemplo anterior para que somente os usuários especificados
no grupo admins do arquivo criado acima:
</para>
<screen>
&lt;Location /teste&gt;
 AuthName "Acesso a página do Foca Linux"
 AuthType basic
 AuthUserFile /home/gleydson/SenhaUsuario
 AuthGroupFile /home/gleydson/SenhaGrupo
 Require group admins
&lt;/Location&gt;
</screen>
<para>
Agora somente os usuários pertencentes ao grupo <emphasis>admins</emphasis>
(<emphasis>gleydson</emphasis> e <emphasis>usuario2</emphasis>) poderão ter
acesso ao diretório <filename>/teste</filename>.
</para>
<para>
<emphasis role="strong">OBS1</emphasis>: Verifique se o servidor Web possui
acesso a leitura no arquivo de senhas de usuários e grupos, caso contrário será
retornado um código "500 - Internal Server Error".  Este tipo de erro é
caracterizado por tudo estar OK na sintaxe dos arquivos de configuração após
checagem com "apache -t" e todas as diretivas de controle de acesso apontam
para os diretórios e arquivos corretos.
</para>
<para>
<emphasis role="strong">OBS2:</emphasis>: Sempre use espaços para separar os
nomes de usuários pertencentes a um grupo.
</para>
<para>
<emphasis role="strong">OBS3</emphasis>: NUNCA coloque os arquivos que contém
senhas e grupos em diretórios de acesso público onde usuários podem ter acesso
via o servidor Web.  Tais localizações são <filename>/var/www</filename>,
<filename>/home/"usuario"/public_html</filename> e qualquer outro diretório de
acesso público que defina em seu sistema.
</para>
<para>
É recomendável também ocultar estes arquivos através da diretiva &lt;Files&gt;
evitando possíveis riscos de segurança com usuários acessando os arquivos de
senha e grupo.
</para>
<para>
Na distribuição <command>Debian</command>, qualquer arquivo iniciando com
<filename>.ht*</filename> será automaticamente ocultado pelo sistema, pois já
existe uma diretiva &lt;Files ~ "\.ht"&gt;.  Tal diretiva pode também ser
especificada no arquivo de acesso <filename>.htaccess</filename>.  Assim um
arquivo <filename>.htsenha</filename> e <filename>.htgroup</filename> são bons
nomes se estiver desejando ocultar dados de olhos curiosos...
</para>
</section>

</section>

<section id="s-apache-acesso-restr-autor+auth"><title>Usando autorização e autenticação juntos</title>
<para>
Os métodos de <emphasis>autorização</emphasis> e
<emphasis>autenticação</emphasis> podem ser usados ao mesmo tempo dentro de
qualquer uma das diretivas de controle de acesso.  As diretivas de
<emphasis>autorização</emphasis> são processadas primeiro (mod_access) e depois
as diretivas de <emphasis>autenticação</emphasis> (mod_auth).  Segue um
exemplo:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 Order deny,allow
 allow from .dominiolocal.com.br
 deny from all
 AuthName "Acesso ao diretório do servidor Web"
 AuthType basic
 AuthUserFile /var/cache/apache/senhas
 Require valid-user
&lt;/Directory&gt;
</screen>
<para>
Para ter acesso ao diretório <filename>/var/www</filename>, primeiro o
computador deve fazer parte do domínio
<filename>.dominiolocal.com.br</filename>, assim ela passa pelo teste de
autorização, depois disso será necessário fornecer o login e senha para acesso
a página, digitando o login e senha corretos, o teste de autenticação será
completado com sucesso e o acesso ao diretório <filename>/var/www</filename>
autorizado.
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 Order mutual-failure
 allow from .dominiolocal.com.br
 deny from lammer.dominiolocal.com.br
 AuthName "Acesso ao diretório do servidor Web"
 AuthType basic
 AuthUserFile /var/cache/apache/senhas
 AuthGroupFile /var/cache/apache/grupos
 Require group admins
&lt;/Directory&gt;
</screen>
<para>
No exemplo acima, é usado o método de autorização com a opção <emphasis>Order
mutual-failure</emphasis> e o método de autenticação através de
<emphasis>grupos</emphasis>.  Primeiro é verificado se o usuário pertence ao
domínio <filename>.dominiolocal.com.br</filename> e se ele não está acessando
da máquina <filename>lammer.dominiolocal.com.br</filename>, neste caso ele
passa pelo teste de autorização.  Depois disso ele precisará fornecer o nome e
senha válidos, com o login pertencente ao <emphasis>AuthGroupFile</emphasis>,
passando pelo processo de autenticação e obtendo acesso ao diretório
<filename>/var/www</filename>.
</para>
<section id="s-apache-acesso-restr-autor+auth-diferenciado"><title>Acesso diferenciado em uma mesma diretiva</title>
<para>
É interessante permitir usuários fazendo conexões de locais confiáveis terem
acesso direto sem precisar fornecer nome e senha e de locais inseguros
acessarem somente após comprovarem <emphasis role="strong">quem</emphasis>
realmente são.  Como é o caso de permitir usuários de uma rede privada terem
acesso completo aos recursos e permitir o acesso externo ao mesmo recurso
somente através de senha.  Isto pode ser feito com o uso da diretiva
<emphasis>Satisfy</emphasis> junto ao bloco de
<emphasis>autorização/autenticação</emphasis>.  Vamos tomar como base o exemplo
anterior:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 Order mutual-failure
 allow from .dominiolocal.com.br
 deny from lammer.dominiolocal.com.br
 AuthName "Acesso ao diretório do servidor Web"
 AuthType basic
 AuthUserFile /var/cache/apache/senhas
 AuthGroupFile /var/cache/apache/grupos
 Require group admins
 Satisfy any
&lt;/Directory&gt;
</screen>
<para>
Note que o exemplo é o mesmo com a adição da diretiva <emphasis>Satisfy
any</emphasis> no final do bloco do arquivo.  Quando a opção
<emphasis>Satisfy</emphasis> não é especificada, ela assumirá "all" como
padrão, ou seja, o usuário deverá passar no teste de autorização e autenticação
para ter acesso.
</para>
<para>
A diferença do exemplo acima em relação ao da seção anterior é se a máquina
passar no teste de autorização ela já terá acesso garantido.  Caso falhe no
teste de autorização, ainda terá a chance de ter acesso a página passando na
checagem de autenticação.
</para>
<para>
Isto garante acesso livre aos usuários do domínio
<filename>.dominiolocal.com.br</filename>.  Já os outros usuários, incluindo
acessos vindos de <filename>lammer.dominiolocal.com.br</filename> que pode ser
uma máquina com muito uso, poderá ter acesso ao recurso caso tenha fornecido um
nome e senha válidos para passar pelo processo de autenticação.  Tenha isto em
mente...  este tipo de problema é comum e depende mais de uma política de
segurança e conduta interna, o sistema de segurança não pode fazer nada a não
ser permitir acesso a um nome e senha válidos.
</para>
<para>
Tenha cuidado com o uso da opção <emphasis>Satisfy</emphasis> em diretivas que
especificam somente o método de autenticação:
</para>
<screen>
&lt;Directory /var/www&gt;
 Options Indexes
 AuthName "Acesso ao diretório do servidor Web"
 AuthType basic
 AuthUserFile /var/cache/apache/senhas
 AuthGroupFile /var/cache/apache/grupos
 Require group admins
 Satisfy any
&lt;/Directory&gt;
</screen>
<para>
ATENÇÃO PARA O DESCUIDO ACIMA!: Como o método de autorização NÃO é
especificado, é assumido <emphasis>deny,allow</emphasis> como padrão, que
permite o acesso a TODOS os usuários.  O bloco acima <emphasis
role="strong">NUNCA</emphasis> executará o método de autenticação por este
motivo.  A melhor coisa é NÃO usar a opção <emphasis>Satisfy</emphasis> em
casos que só requerem autenticação ou usar <emphasis>Satisfy all</emphasis>
(que terá o mesmo efeito de não usa-la, hehehe).
</para>
<para>
A falta de atenção nisto pode comprometer silenciosamente a segurança de seu
sistema.
</para>
</section>

</section>

<section id="s-apache-acesso-restr-htaccess"><title>O arquivo <filename>.htaccess</filename></title>
<para>
O arquivo <filename>.htaccess</filename> deve ser colocado no diretório da
página que deverá ter suas permissões de acesso/listagem controladas.  A
vantagem em relação a inclusão direta de diretivas de acesso dentro do arquivo
de configuração do <command>Apache</command>, é que o controle de acesso poderá
ser definido pelo próprio webmaster da página, sem precisar ter acesso direto a
configuração do <command>Apache</command>, que requerem privilégios de root.
</para>
<para>
Outro ponto fundamental é que não há necessidade de reiniciar o servidor Web,
pois este arquivo é lido no momento de cada acesso ao diretório que controla.
O nome do arquivo OverRide pode ser definido através da diretiva
<emphasis>AccessFileName</emphasis> no arquivo de configuração do
<command>Apache</command>, <filename>.htaccess</filename> é usado como padrão.
</para>
<para>
O controle de que opções estarão disponíveis no <filename>.htaccess</filename>
são definidas na diretiva <emphasis>AllowOverride</emphasis> que pode conter o
seguintes parâmetros:
</para>
<itemizedlist>
<listitem>
<para>
<literal>None</literal> - O servidor não buscará o arquivo
<literal>.htaccess</literal> nos diretórios
</para>
</listitem>
<listitem>
<para>
<literal>All</literal> - O servidor utilizará todas as opções abaixo no arquivo
<filename>.htaccess</filename>
</para>
</listitem>
<listitem>
<para>
<literal>AuthConfig</literal> - Permite o uso de diretivas de autenticação
(<emphasis>AuthDBMGroupFile</emphasis>, <emphasis>AuthDBMUserFile</emphasis>,
<emphasis>AuthGroupFile</emphasis>, <emphasis>AuthName</emphasis>,
<emphasis>AuthType</emphasis>, <emphasis>AuthUserFile</emphasis>,
<emphasis>Require</emphasis>, etc.).
</para>
</listitem>
<listitem>
<para>
<literal>FileInfo</literal> - Permite o uso de diretivas controlando o tipo de
documento (<emphasis>AddEncoding</emphasis>, <emphasis>AddLanguage</emphasis>,
<emphasis>AddType</emphasis>, <emphasis>DefaultType</emphasis>,
<emphasis>ErrorDocument</emphasis>, <emphasis>LanguagePriority</emphasis>,
etc.).
</para>
</listitem>
<listitem>
<para>
<literal>Indexes</literal> - Permite o uso de diretivas controlando a indexação
de diretório (<emphasis>AddDescription</emphasis>,
<emphasis>AddIcon</emphasis>, <emphasis>AddIconByEncoding</emphasis>,
<emphasis>AddIconByType</emphasis>, <emphasis>DefaultIcon</emphasis>,
<emphasis>DirectoryIndex</emphasis>, <emphasis>FancyIndexing</emphasis>,
<emphasis>HeaderName</emphasis>, <emphasis>IndexIgnore</emphasis>,
<emphasis>IndexOptions</emphasis>, <emphasis>ReadmeName</emphasis>, etc.).
</para>
</listitem>
<listitem>
<para>
<literal>Limit</literal> - Permite o uso de diretivas controlando o acesso ao
computador (<emphasis>allow</emphasis>, <emphasis>deny</emphasis> e
<emphasis>order</emphasis>).
</para>
</listitem>
<listitem>
<para>
<literal>Options</literal> - Permite o uso de diretivas controlando
características específicas do diretório (<emphasis>Options</emphasis> e
<emphasis>XBitHack</emphasis>).
</para>
</listitem>
</itemizedlist>
<para>
<emphasis role="strong">OBS</emphasis>: Não tem sentido usar a opção
<emphasis>AllowOverride</emphasis> dentro da diretiva &lt;Location&gt;, ela
será simplesmente ignorada.
</para>
<para>
Para acesso ao arquivo <filename>.htaccess</filename> do diretório
<filename>/var/www/focalinux</filename>, o <command>Apache</command> buscará os
arquivos <filename>.htaccess</filename> na seqüencia:
<filename>/.htaccess</filename>, <filename>/var/.htaccess</filename>,
<filename>/var/www/.htaccess</filename>,
<filename>/var/www/focalinux/.htaccess</filename>, qualquer diretiva que não
exista no <filename>.htaccess</filename> do diretório
<filename>/var/www/focalinux</filename> terá seu valor definido pela diretiva
dos arquivos <filename>.htaccess</filename> dos diretórios anteriores.  Somente
após esta seqüencia de checagens o acesso ao documento é permitido (ou negado).
</para>
<para>
Por este motivo, muitos administradores decidem desativar completamente o uso
de arquivos <filename>.htaccess</filename> no diretório raíz e habilitar
somente nos diretórios especificados pela diretiva &lt;Directory&gt; no arquivo
de configuração do <command>Apache</command>, evitando brechas de segurança na
manipulação destes arquivos (esta é uma boa idéia a não ser que se dedique 24
horas somente na administração do seu servidor Web e conheça toda sua estrutura
hierárquica de segurança:
</para>
<screen>
&lt;Directory /&gt;
 AllowOverride none
&lt;/Directory&gt;

&lt;Directory /var/www&gt;
 AllowOverride limit authconfig indexes
&lt;/Directory&gt;
</screen>
<para>
Na especificação acima, o arquivo <filename>.htaccess</filename> será procurado
no diretório <filename>/var/www</filename> e seus sub-diretórios, usando
somente opções que controlam a autorização de acesso
(<emphasis>limit</emphasis>), autenticação e opções
(<emphasis>authconfig</emphasis>) e de indexação de documentos
(<emphasis>indexes</emphasis>).
</para>
<para>
Alguns exemplos do uso do arquivo <filename>.htaccess</filename>:
</para>
<para>
Para permitir o acesso direto de usuários da rede
<literal>192.168.1.*</literal> diretamente, e requerer senha de acesso para
outros usuários, o seguinte arquivo <filename>.htaccess</filename> deve ser
criado no diretório <filename>/var/www</filename>:
</para>
<screen>
Order deny,allow
allow from 192.168.1.0/24
deny from all
AuthName "Acesso a página Web principal da Empresa"
AuthType basic
AuthUserFile /var/cache/apache/senhas
Require valid-user
Satisfy any
</screen>
<para>
Note que a sintaxe é exatamente a mesma das usadas na diretivas de acesso, por
este motivo vou dispensar explicações detalhadas a respeito.
</para>
<para>
<emphasis role="strong">ATENÇÃO</emphasis>: A diretiva <emphasis>Options
Indexes</emphasis> deverá ser especificada no
<emphasis>AllowOverRide</emphasis> e não no arquivo
<filename>.htaccess</filename>.  Agora você já sabe o que fazer se estiver
recebendo erros 500 ao tentar acessar a página (Erro interno no servidor)...
</para>
</section>

<section id="s-apache-acesso-setenvif"><title>Usando a diretiva SetEnvIf com Allow e Deny</title>
<para>
É possível especificar o acesso baseado em variáveis de ambiente usando a
diretiva <emphasis>SetEnvIf</emphasis>, isto lhe permite controlar o acesso de
acordo com o conteúdo de cabeçalhos HTTP.  A sintaxe é a seguinte:
</para>
<para>
<literal>SetEnvIf [<emphasis>atributo</emphasis>]
[<emphasis>expressão</emphasis>] [<emphasis>variável</emphasis>]</literal>
</para>
<para>
Isto poder ser facilmente interpretado como: Se o "atributo" especificado
conter a "expressão", a "variável" será criada e armazenará o valor verdadeiro.
Veja abaixo:
</para>
<screen>
SetEnvIf User-Agent ".*MSIE*." EXPLODER
&lt;Directory /var/www&gt;
 Order deny,allow
 allow from all
 deny from env=EXPLODER
&lt;/Directory&gt;
</screen>
<para>
Se o Navegador (campo <emphasis>User-Agent</emphasis> do cabeçalho http) usado
para acessar a página for o <literal>Internet Explorer</literal>, a variável
<replaceable>EXPLODER</replaceable> será criada e terá o valor verdadeiro
(porque a expressão de <emphasis>SetEnvIf</emphasis> conferiu com a expressão).
</para>
<para>
Note o uso de "deny from env=VARIÁVEL".  Neste caso se o navegador for o
<literal>Internet Explorer</literal>, o acesso será bloqueado (pois o navegador
conferiu, assim a variável <replaceable>EXPLODER</replaceable> recebeu o valor
verdadeiro).
</para>
<para>
É permitido especificar as diretivas de acesso normais junto com especificação
de variáveis de ambiente, basta separa-los com espaços.  Uma descrição completa
dos cabeçalhos HTTP, conteúdo e parâmetros aceitos por cada um são descritos na
<literal>RFC 2068</literal>.
</para>
</section>

<section id="s-apache-acesso-limit"><title>A diretiva &lt;Limit&gt;</title>
<para>
Esta diretiva é semelhante a &lt;Directory&gt; mas trabalha com métodos HTTP
(como GET, PUT, POST, etc) ao invés de diretórios.  A diretiva &lt;Limit&gt;
pode ser usada dentro da diretiva de acesso &lt;Directory&gt;,
&lt;Location&gt;, mas nenhuma diretiva de controle de acesso pode ser colocada
dentro de &lt;Limit&gt;.
</para>
<para>
Os métodos HTTP válidos são: GET, POST, PUT DELETE, CONNECT, OPTIONS, TRACE,
PATCH, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK e UNLOCK.  Note que os
métodos são case-sensitive.  Por exemplo:
</para>
<screen>
&lt;Directory /var/www&gt;
 Option Indexes
  &lt;Limit POST PUT DELETE&gt;
     Order deny,allow
     allow from 192.168.1.0/24
     deny from all
   &lt;/Limit&gt;
&lt;/Directory&gt;
</screen>
<para>
Somente permitem o uso dos métodos POST, PUT, DELETE de máquinas da rede
interna.
</para>
<para>
<emphasis role="strong">OBS1</emphasis>: Se o método GET é bloqueado, o
cabeçalho HTTP também será bloqueado.
</para>
<para>
<emphasis role="strong">OBS2</emphasis>: A diretiva de acesso &lt;Limit&gt;
somente terá efeito na diretiva &lt;Location&gt; se for especificada no arquivo
de configuração do servidor web.  A diretiva &lt;Location&gt; simplesmente é
ignorada nos arquivos <filename>.htaccess</filename>...
</para>
<para>
Este abaixo é usado por padrão na distribuição <command>Debian</command> para
restringir para somente leitura o acesso aos diretórios de usuários acessados
via módulo <filename>mod_userdir</filename>:
</para>
<screen>
&lt;Directory /home/*/public_html&gt;
    AllowOverride FileInfo AuthConfig Limit
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    &lt;Limit GET POST OPTIONS PROPFIND&gt;
        Order allow,deny
        Allow from all
    &lt;/Limit&gt;
    &lt;Limit PUT DELETE PATCH PROPPATCH MKCOL COPY MOVE LOCK UNLOCK&gt;
        Order deny,allow
        Deny from all
    &lt;/Limit&gt;
&lt;/Directory&gt;
</screen>
</section>

<section id="s-apache-acesso-limitexcept"><title>Diretiva &lt;LimitExcept&gt;</title>
<para>
Esta diretiva é semelhante a &lt;Limit&gt;, mas atinge todos os métodos HTTP,
menos os especificados.
</para>
</section>

</section>

<section id="s-apache-errordocument"><title>Definindo documentos de erro personalizados</title>
<para>
Documentos de erros personalizados são definidos através da diretiva
<emphasis>ErrorDocument</emphasis>.  É possível especificar códigos de erros
que serão atendidos por certos documentos ou colocar esta diretiva dentro de
blocos de controle de acesso &lt;Directory&gt;, &lt;Location&gt; ou
&lt;VirtualHost&gt; para que tenham mensagens de erro personalizadas, ao invés
da padrão usada pelo servidor <command>httpd</command>.
</para>
<para>
<literal>ErrorDocument [<emphasis>código de erro</emphasis>]
[<emphasis>documento</emphasis>]</literal>
</para>
<para>
Onde:
</para>
<variablelist>
<varlistentry>
<term><emphasis>código de erro</emphasis></term>
<listitem>
<para>
Código de erro da mensagem (veja <xref linkend="s-apache-httpcodes"/> como
referência).  O código de erro <emphasis>401</emphasis> deve referir-se a um
arquivo local.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis>documento</emphasis></term>
<listitem>
<para>
Documento, mensagem de erro ou redirecionamento que será usado no servidor caso
aquele código de erro seja encontrado:
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
Para definir uma mensagem de erro padrão para todo servidor web, basta colocar
a diretiva <emphasis>ErrorDocument</emphasis> fora das diretivas que controlam
o acesso a diretórios e virtual hosts (o inicio do arquivo
<filename>httpd.conf</filename> é ideal).
</para>
<para>
Exemplos:
</para>
<itemizedlist>
<listitem>
<para>
<literal>ErrorDocument 404 /cgi-bin/erros404.pl</literal> - Direciona para um
script em Perl que manda um e-mail ao administrador falando sobre o link
quebrado e envia o usuário a uma página de erro padrão.
</para>
</listitem>
<listitem>
<para>
<literal>ErrorDocument 404 /naoencontrada.html</literal> - Direciona o usuário
para o arquivo <filename>naoencontrada.html</filename> (dentro de
<emphasis>DocumentRoot</emphasis>) quando ocorrer o erro 404.  Note que o
diretório <filename>/</filename> levado em consideração é o especificado pela
diretiva <emphasis>DocumentRoot</emphasis>.
</para>
</listitem>
<listitem>
<para>
<literal>ErrorDocument 500 "Erro Interno no servidor"</literal> - Mostra a
mensagem na tela quando ocorrer o erro 500.
</para>
</listitem>
<listitem>
<para>
<literal>ErrorDocument 401 /obtendoacesso.html</literal> - Direciona o usuário
ao arquivo explicando como obter acesso ao sistema.
</para>
</listitem>
<listitem>
<para>
<literal>ErrorDocument 503 http://www.guiafoca.org/servicos.html</literal> -
Redireciona o usuário a URL especificada.
</para>
</listitem>
<listitem>
<para>
<literal>ErrorDocument 403 "Acesso negado"</literal> - Mostra a mensagem na
tela no caso de erros 403.
</para>
</listitem>
</itemizedlist>
</section>

<section id="s-apache-dso"><title>Módulos DSO</title>
<para>
Os módulos <emphasis>DSO</emphasis> permitem adicionar/remover características
do <command>Apache</command> sem necessidade de recompilar todo o servidor web,
assim interrompendo o serviço para a atualização dos arquivos.  Módulos de
programas terceiros também podem ser compilados e adicionado sem problemas
através deste recurso.
</para>
<para>
Os módulos são carregados para a memória no momento que o
<command>apache</command> é iniciado através da diretiva
<emphasis>LoadModule</emphasis> no arquivo de configuração.  Dessa forma, toda
vez que um novo módulo for adicionado, removido ou alterado, será necessário
reiniciar o servidor <command>apache</command>.  A sintaxe da linha para
carregar módulos <filename>.so</filename> é a seguinte:
</para>
<para>
<literal>LoadModule [<emphasis>nome_do_modulo</emphasis>]
[<emphasis>caminho_do_arquivo_so</emphasis>]</literal>
</para>
<variablelist>
<varlistentry>
<term><emphasis>nome_do_modulo</emphasis></term>
<listitem>
<para>
Especifica o nome do módulo, não deve conter espaços.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis>caminho_do_arquivo_so</emphasis></term>
<listitem>
<para>
Define a localização do arquivo que contém o módulo especificado.  Por padrão
os módulos estão localizados em <filename>/usr/lib/apache/[versão]</filename>
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
A posição em que os módulos aparecem podem ter influência em seu funcionamento,
alguns requerem que sejam especificados antes de outros módulos para
funcionarem corretamente (como o módulo <emphasis>php3_module</emphasis>, que
deve ser carregado antes de qualquer módulo de controle de CGI's).  Leia a
documentação específica sobe o módulo em caso de dúvidas, os módulos que
acompanham o <command>Apache</command> são documentados em detalhes no manual
do <command>Apache</command>.
</para>
<para>
Para usar uma característica/diretiva/opção do <command>Apache</command> que
dependa de um certo módulo, obviamente você deverá carregar o módulo
correspondente (em caso de dúvidas, leia a documentação sobre o módulo).  Veja
a <xref linkend="s-apache-exemplo-httpd"/> para exemplos do uso da diretiva
<emphasis>LoadModule</emphasis>.
</para>
<para>
Por exemplo, se você quiser utilizar as diretivas de autorização
(<emphasis>allow, deny, order</emphasis>) deverá ter o módulo
<emphasis>mod_access</emphasis> carregado, para usar as diretivas de
autorização (<emphasis>authname, authuserfile, authtype, etc</emphasis>) deverá
ter o módulo <emphasis>mod_auth</emphasis> carregado.  Mais detalhes podem ser
encontrados em <xref linkend="s-apache-acesso-restr-autor"/>.  <emphasis
role="strong">OBS1</emphasis>: O suporte a <emphasis>DSO</emphasis> atualmente
só está disponível para plataforma <command>UNIX</command> e seus derivados,
como o <command>Linux</command>.
</para>
<para>
Também é possível ativar certas diretivas verificando se o módulo
correspondente estiver ou não carregado através da diretiva
<emphasis>IfModule</emphasis>:
</para>
<screen>
&lt;IfModule mod_userdir.c&gt;
 UserDir disabled root
 UserDir public_html
&lt;/IfModule&gt;
</screen>
<para>
Nas linhas acima, as diretivas <emphasis>UserDir</emphasis> somente serão
executadas se o módulo <emphasis>mod_userdir.c</emphasis> estiver carregado
através da diretiva <emphasis>LoadModule</emphasis>.
</para>
<para>
Segue abaixo uma lista de módulos padrões que acompanham do
<command>Apache</command>, os módulos marcados com "*" são ativados por padrão:
</para>
<variablelist>
<varlistentry>
<term>Criação de Ambiente</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_env</literal> - Ajusta variáveis de ambiente para scripts
CGI/SSI
</para>
</listitem>
<listitem>
<para>
<literal>* mod_setenvif</literal> - Ajusta variáveis de ambiente de acordo com
cabeçalhos http
</para>
</listitem>
<listitem>
<para>
<literal>mod_unique_id</literal> - Gera identificadores únicos para requisições
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Decisão de tipo de conteúdo de arquivos</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_mime</literal> - Determinação de tipo/encodificação do conteúdo
(configurado)
</para>
</listitem>
<listitem>
<para>
<literal>mod_mime_magic</literal> - Determinação de tipo/encodificação do
conteúdo (automático)
</para>
</listitem>
<listitem>
<para>
<literal>* mod_negotiation</literal> - Seleção de conteúdo baseado nos
cabeçalhos "HTTP Accept*"
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Mapeamento de URL</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_alias</literal> - Tradução e redirecionamento de URL simples
</para>
</listitem>
<listitem>
<para>
<literal>mod_rewrite</literal> - Tradução e redirecionamento de URL avançado
</para>
</listitem>
<listitem>
<para>
<literal>* mod_userdir</literal> - Seleção de diretórios de recursos por nome
de usuário
</para>
</listitem>
<listitem>
<para>
<literal>mod_speling</literal> - Correção de URLs digitadas incorretamente
</para>
</listitem>
<listitem>
<para>
<literal>mod_vhost_alias</literal> - Suporte para virtual hosts dinamicamente
configurados em massa.
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Manipulação de Diretórios</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_dir</literal> - Manipulação de Diretório e arquivo padrão de
diretório
</para>
</listitem>
<listitem>
<para>
<literal>* mod_autoindex</literal> - Geração de índice automático de diretório
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Controle de Acesso</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_access</literal> - Controle de acesso por autorização (usuário,
endereço, rede)
</para>
</listitem>
<listitem>
<para>
<literal>* mod_auth</literal> - Autenticação HTTP básica (usuário, senha)
</para>
</listitem>
<listitem>
<para>
<literal>mod_auth_dbm</literal> - Autenticação HTTP básica (através de arquivos
NDBM do Unix)
</para>
</listitem>
<listitem>
<para>
<literal>mod_auth_db</literal> - Autenticação HTTP básica (através de arquivos
Berkeley-DB)
</para>
</listitem>
<listitem>
<para>
<literal>mod_auth_anon</literal> - Autenticação HTTP básica para usuários no
estilo anônimo
</para>
</listitem>
<listitem>
<para>
<literal>mod_auth_digest</literal> - Autenticação MD5
</para>
</listitem>
<listitem>
<para>
<literal>mod_digest</literal> - Autenticação HTTP Digest
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Respostas HTTP</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>mod_headers</literal> - Cabeçalhos de respostas HTTP (configurado)
</para>
</listitem>
<listitem>
<para>
<literal>mod_cern_meta</literal> - Cabeçalhos de respostas HTTP (arquivos no
estilo CERN)
</para>
</listitem>
<listitem>
<para>
<literal>mod_expires</literal> - Respostas de expiração HTTP
</para>
</listitem>
<listitem>
<para>
<literal>* mod_asis</literal> - Respostas HTTP em formato simples (raw)
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Scripts</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_include</literal> - Suporte a Includes no lado do servidor (SSI
- Server Sides Includes)
</para>
</listitem>
<listitem>
<para>
<literal>* mod_cgi</literal> - Suporte a CGI (Common Gateway Interface)
</para>
</listitem>
<listitem>
<para>
<literal>* mod_actions</literal> - Mapeia scripts CGI para funcionarem como
'handlers' internos.
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Manipuladores de conteúdo Interno</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_status</literal> - Visualiza status do servidor em tempo de
execução.
</para>
</listitem>
<listitem>
<para>
<literal>mod_info</literal> - Visualiza sumário de configuração do servidor.
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Registros de Requisições</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_log_config</literal> - Registro de requisições personalizáveis
</para>
</listitem>
<listitem>
<para>
<literal>mod_log_agent</literal> - Registro especializado do User-Agent HTTP
(depreciado)
</para>
</listitem>
<listitem>
<para>
<literal>mod_log_refer</literal> - Registro especializado do Referrer HTTP
(depreciado)
</para>
</listitem>
<listitem>
<para>
<literal>mod_usertrack</literal> - Registro de cliques de usuários através de
Cookies HTTP
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Outros</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>* mod_imap</literal> - Suporte a Mapeamento de Imagem no lado do
servidor.
</para>
</listitem>
<listitem>
<para>
<literal>mod_proxy</literal> - Módulo de Cache do Proxy (HTTP, HTTPS, FTP).
</para>
</listitem>
<listitem>
<para>
<literal>mod_so</literal> - Inicialização do Dynamic Shared Object (DSO)
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Experimental</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>mod_mmap_static</literal> - Cache de páginas freqüentemente servidas
via mmap()
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>Desenvolvimento</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>mod_example</literal> - Demonstração da API do Apache (somente
desenvolvedores)
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>

<section id="s-apache-log"><title>Sistema de Log do Apache</title>
<para>
O <command>Apache</command> é bem flexível na especificação do que será
registrado em seus arquivos de log, possibilitando utilizar um arquivo de log
único, diversos arquivos de logs registrando cada evento ocorrido no sistema
(conexão, navegador, bloqueio de acesso, erros, etc) incluindo os campos que
deseja em cada arquivo e a ordem dos campos em cada um deles.
</para>
<para>
Enfim qualquer coisa pode ser especificada de forma que atenda as suas
necessidades particulares de logging.
</para>
<section id="s-apache-log-agentlog"><title>AgentLog</title>
<para>
<literal>AgentLog arquivo/pipe</literal>: Indica o nome do arquivo que
registrará o nome do navegador que está acessando a página (conteúdo do
cabeçalho <literal>User-Agent</literal>).  É possível usar o pipe "|" para
direcionar os erros para um programa de formatação ou processamento.  <emphasis
role="strong">ATENÇÃO</emphasis>: Se um programa for usado como pipe, ele será
executado sob o usuário que iniciou o <command>apache</command>.  Revise o
código fonte do programa para ter certeza que não contém falhas que possam
comprometer a segurança de seu sistema.
</para>
<para>
Exemplo: <literal>AgentLog /var/log/apache/agent.log</literal>
</para>
</section>

<section id="s-apache-log-errorlog"><title>ErrorLog</title>
<para>
<literal>ErrorLog arquivo/pipe</literal> - Especifica o arquivo que registrará
as mensagens de erro do servidor <command>Apache</command>.  É possível usar o
pipe "|" para direcionar os erros para um programa de formatação ou
processamento.
</para>
<para>
Exemplo: <literal>ErrorLog /var/log/apache/errors.log</literal>
</para>
</section>

<section id="s-apache-log-customlog"><title>CustomLog</title>
<para>
Permite especificar onde os logs serão gravados para os arquivos de logs
personalizados.  Esta diretiva também aceita apelidos definidos pela diretiva
<emphasis>LogFormat</emphasis>.
</para>
<para>
<literal>CustomLog [arquivo/pipe] [formato/nome]</literal>
</para>
<para>
Onde:
</para>
<variablelist>
<varlistentry>
<term><emphasis>arquivo/pipe</emphasis></term>
<listitem>
<para>
Arquivo de log personalizado ou pipe.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis>formato/nome</emphasis></term>
<listitem>
<para>
Especifica o formato do arquivo de log (da mesma forma que o especificado na
opção <emphasis>LogFormat</emphasis>).  Deverá ser especificado entre "aspas"
caso tiver espaços.  Veja <xref linkend="s-apache-log-logformat"/> para
detalhes.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
Ao invés de especificar o formato, também é possível usar um apelido definido
pela opção <emphasis>LogFormat</emphasis> (<xref
linkend="s-apache-log-logformat"/>), neste caso os parâmetros definidos pelo
<emphasis>LogFormat</emphasis> para "nome" serão atribuídos a diretiva
<emphasis>CustomLog</emphasis>.
</para>
<para>
Exemplos:
</para>
<itemizedlist>
<listitem>
<para>
<literal>CustomLog /var/log/apache/common.log "%h %l %u %t \"%r\" %>s
%b"</literal>
</para>
</listitem>
<listitem>
<para>
<literal>CustomLog /var/log/apache/common.log common</literal>
</para>
</listitem>
</itemizedlist>
</section>

<section id="s-apache-log-refererlog"><title>RefererLog</title>
<para>
<literal>RefererLog [arquivo/pipe]</literal>: Indica que arquivo/pipe
registrará os campos Referer do cabeçalho HTTP.  Esta diretiva é mantida por
compatibilidade com o servidor web NCSA 1.4.
</para>
<para>
A configuração padrão do <command>Apache</command> usa uma diretiva alternativa
para a especificação do <emphasis>referer</emphasis> que é a seguinte:
</para>
<screen>
LogFormat "%{Referer}i -> %U" referer
CustomLog /var/log/apache/referer.log referer
</screen>
<para>
Exemplo: <literal>RefererLog /var/log/apache/referer.log</literal>
</para>
</section>

<section id="s-apache-log-rewritelog"><title>RewriteLog</title>
<para>
<literal>RewriteLog: [arquivo/pipe]</literal>: Indica o arquivo/pipe que
registrará qualquer regravação de URL feita pelo <command>Apache</command>.
</para>
<para>
<emphasis role="strong">OBS</emphasis>: Não é recomendável direcionar o nome de
arquivo para <filename>/dev/null</filename> como forma de desativar este log,
porque o módulo de regravação não cria a saída para um arquivo de log, ele cria
a saída de log internamente.  Isto somente deixará o servidor lento.  Para
desativar este registro, simplesmente remova/comente a diretiva RewriteLog ou
use a opção RewriteLogLevel 0.
</para>
<para>
Exemplo: <literal>RewriteLog "/usr/local/var/apache/logs/rewrite.log</literal>
</para>
</section>

<section id="s-apache-log-rewriteloglevel"><title>RewriteLogLevel</title>
<para>
<literal>RewriteLogLevel [num]</literal>: Especifica os detalhes que serão
incluídos no registro da opção RewriteLog, os valores permitidos estão entre 0
e 9.  Se for usado 0, o registro do RewriteLog é totalmente desativado (esta é
a padrão).  <emphasis role="strong">OBS</emphasis>: Qualquer valor acima de 2
deixa o servidor Web cada vez mais lento devido ao processamento e a quantidade
de detalhes registrados no arquivo especificado por
<emphasis>RewriteLog</emphasis>.
</para>
</section>

<section id="s-apache-log-scriptlog"><title>ScriptLog</title>
<para>
<literal>ScriptLog [arquivo]</literal>: Especifica o nome do arquivo de log que
receberá as mensagens de erros gerados por scripts CGI executados no servidor.
Esta opção é controlada pelo módulos <emphasis>mod_cgi</emphasis>.
</para>
<para>
Os arquivos de log serão abertos por um sub-processo rodando com as permissões
do usuário especificado na diretiva "user".
</para>
<para>
<emphasis role="strong">OBS</emphasis>: Esta opção somente é recomendada como
depuradora de scripts CGI, não para uso contínuo em servidores ativos.
</para>
<para>
Exemplo: <literal>ScriptLog /var/log/apache/cgiscripts.log</literal>
</para>
</section>

<section id="s-apache-log-scriptlogbuffer"><title>ScriptLogBuffer</title>
<para>
<literal>ScriptLogBuffer</literal>: Especifica o tamanho do cabeçalho PUT ou
POST gravado no arquivo especificado por <emphasis>ScriptLog</emphasis>.  O
valor padrão é 1024 bytes.  Esta opção é controlada pelo módulos
<emphasis>mod_cgi</emphasis>
</para>
<para>
Exemplo: <literal>ScriptLogBuffer 512</literal>
</para>
</section>

<section id="s-apache-log-scriptloglength"><title>ScriptLogLength</title>
<para>
<literal>ScriptLogLength: [tamanho]</literal>: Especifica o tamanho máximo do
arquivo de log gerado pela opção ScriptLog.  O valor padrão é 10385760 bytes
(10.3MB).  Esta opção é controlada pelo módulos <emphasis>mod_cgi</emphasis>
</para>
<para>
Exemplo: <literal>ScriptLogLength 1024480</literal>
</para>
</section>

<section id="s-apache-log-logformat"><title>LogFormat</title>
<para>
<literal>LogFormat</literal>: Define os campos padrões do arquivo gerado pela
opção <emphasis>TransferLog</emphasis>.  O seu formato é o seguinte:
</para>
<para>
<literal>LogFormat [formato] [nome]</literal>
</para>
<para>
Quando o formato não é especificado, assume o valor padrão <literal>%h %l %u %t
\"%r\" %s %b</literal>.  A especificação do [<emphasis>nome</emphasis>] permite
que você utilize o formato especificado em uma opção
<emphasis>CustomLog</emphasis> ou outra diretiva
<emphasis>LogFormat</emphasis>, facilitando a especificação do formato do log.
</para>
<para>
Os seguintes formatos são válidos:
</para>
<itemizedlist>
<listitem>
<para>
<literal>%b</literal> - Bytes enviados, excluindo cabeçalhos HTTP.
</para>
</listitem>
<listitem>
<para>
<literal>%f</literal> - Nome do arquivo.
</para>
</listitem>
<listitem>
<para>
<literal>%{FOOBAR}e</literal> - O conteúdo da variável de ambiente FOOBAR.
</para>
</listitem>
<listitem>
<para>
<literal>%h</literal> - Máquina cliente.
</para>
</listitem>
<listitem>
<para>
<literal>%a</literal> - Endereço IP da máquina cliente.
</para>
</listitem>
<listitem>
<para>
<literal>%A</literal> - Endereço IP local.  Muito útil em virtual hostings.
</para>
</listitem>
<listitem>
<para>
<literal>%{Foobar}i</literal> - O conteúdo de Foobar: linhas de cabeçalho na
requisição enviada ao servidor.
</para>
</listitem>
<listitem>
<para>
<literal>%l</literal> - O nome de login remoto enviado pelo identd (se
fornecido).
</para>
</listitem>
<listitem>
<para>
<literal>%{Foobar}n</literal> - O conteúdo de "FooBar" de outro módulo.
</para>
</listitem>
<listitem>
<para>
<literal>%{Foobar}o:</literal> - O conteúdo de Foobar: linhas de cabeçalho na
resposta.
</para>
</listitem>
<listitem>
<para>
<literal>%p</literal> - A porta do servidor servindo a requisição.
</para>
</listitem>
<listitem>
<para>
<literal>%P</literal> - A identificação do processo filho que serviu a
requisição.
</para>
</listitem>
<listitem>
<para>
<literal>%r</literal> - A primeira linha da requisição.
</para>
</listitem>
<listitem>
<para>
<literal>%s</literal> - Status.  Para requisições que foram redirecionadas.
internamente.  Este é o status de uma requisição *original*.  Use %s para a
última.
</para>
</listitem>
<listitem>
<para>
<literal>%t</literal> - Hora, no formato do arquivo de log (formato inglês
padrão).
</para>
</listitem>
<listitem>
<para>
<literal>%{format}t</literal> - Hora, no formato definido por strftime.
</para>
</listitem>
<listitem>
<para>
<literal>%T</literal> - O tempo necessário para servir a requisição, em
segundos.
</para>
</listitem>
<listitem>
<para>
<literal>%u</literal> - Usuário remoto (através do auth, pode ser falso se o
status de retorno (%s) for 401).
</para>
</listitem>
<listitem>
<para>
<literal>%U</literal> - O caminho da URL requisitada.
</para>
</listitem>
<listitem>
<para>
<literal>%v</literal> - O nome canônico definido por
<emphasis>ServerName</emphasis> que serviu a requisição.
</para>
</listitem>
<listitem>
<para>
<literal>%V</literal> - O nome do servidor de acordo com a configuração de
<emphasis>UseCanonicalName</emphasis>.
</para>
</listitem>
</itemizedlist>
<para>
Exemplos:
</para>
<screen>
 LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %T %v" full
 LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %P %T" debug
 LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
 LogFormat "%h %l %u %t \"%r\" %>s %b" common
 LogFormat "%{Referer}i -> %U" referer
 LogFormat "%{User-agent}i" agent
</screen>
</section>

<section id="s-apache-log-transferlog"><title>TransferLog</title>
<para>
<literal>TransferLog [arquivo/pipe]</literal>: Indica o arquivo que armazenará
as transferências entre o servidor http e o cliente.  Ela cria o arquivo de log
com o formato definido pela opção <emphasis>LogFormat</emphasis> mais recente
(sem a especificação do nome associado a diretiva) ou o formato padrão CLF do
log do <command>Apache</command>.
</para>
<para>
Se omitido, o arquivo não será gerado
</para>
<para>
Exemplo: <literal>TransferLog /var/log/apache/transferências.log</literal>
</para>
<para>
<emphasis role="strong">OBS:</emphasis> Se esta não é uma opção muito utilizada
na administração de seus sistemas, é recomendável o uso da diretiva
<emphasis>CustomLog</emphasis> (veja <xref linkend="s-apache-log-customlog"/>)
para evitar confusões futuras.
</para>
</section>

<section id="s-apache-log-loglevel"><title>LogLevel</title>
<para>
Define o nível de alerta das mensagens que serão gravadas no arquivo
especificado pela diretiva <emphasis>ErrorLog</emphasis>.  Quando não é
especificado, assume o nível "error" como padrão.  Abaixo os parâmetros aceitos
em sua respectiva ordem de importância:
</para>
<itemizedlist>
<listitem>
<para>
<literal>emerg</literal> - O sistema está inutilizável.
</para>
</listitem>
<listitem>
<para>
<literal>alert</literal> - A ação deve ser tomada imediatamente.
</para>
</listitem>
<listitem>
<para>
<literal>crit</literal> - Condições críticas.
</para>
</listitem>
<listitem>
<para>
<literal>error</literal> - Condições de erro.
</para>
</listitem>
<listitem>
<para>
<literal>warn</literal> - Condições de alerta.
</para>
</listitem>
<listitem>
<para>
<literal>notice</literal> - Condição normal mas significante.
</para>
</listitem>
<listitem>
<para>
<literal>info</literal> - Mensagens informativas.
</para>
</listitem>
<listitem>
<para>
<literal>debug</literal> - Mensagens do nível de depuração.
</para>
</listitem>
</itemizedlist>
<para>
Note que os níveis são os mesmos usados pelo <command>syslog</command>.  Quando
um nível particular é especificado, as mensagens de todos os níveis de maior
importância também serão registrados.  Por exemplo, se o nível "info" for
especificado, as mensagens com os níveis de "notice" e "warn" também serão
registradas.  É recomendado o uso de um nível de no mínimo
<emphasis>crit</emphasis>.
</para>
</section>

<section id="s-apache-log-anonylogmail"><title>Anonymous_LogEmail</title>
<para>
Se estiver como "on" a senha digitada será registrada no arquivo especificado
por <emphasis>ErrorLog</emphasis>.  Esta diretiva é
<emphasis>ativada</emphasis> por padrão.
</para>
<para>
Exemplo: <literal>Anonymous_LogEmail off</literal>
</para>
</section>

<section id="s-apache-log-cookielog"><title>CookieLog</title>
<para>
Especifica o arquivo que será usado para registrar os cookies
</para>
<para>
<emphasis role="strong">OBS1</emphasis>: Caso o caminho do arquivo não for
especificado nas diretivas, será assumido <emphasis>DocumentRoot</emphasis>
como diretório padrão.
</para>
<para>
<emphasis role="strong">OBS2</emphasis>: Caso esteja usando o pipe, o dono do
processo será o mesmo que iniciou o servidor WEB Apache.  Tenha certeza do
funcionamento do programa para não comprometer o seu sistema, e cuide para que
ele não possa ser modificado indevidamente por outros usuários.
</para>
<para>
Exemplo: <literal>CookieLog /var/log/apache/cookies.log</literal>
</para>
</section>

<section id="s-apache-log-webalizer"><title>Relatório gráfico de acesso ao sistema</title>
<para>
O programa <command>webalizer</command> poderá ser instalado para gerar um
relatório gráfico com a estatísticas de visitas por ano/mes/dia/hora usando os
dados do <filename>access.log</filename>.  Outra interessante característica
são as estatísticas de códigos http (veja <xref
linkend="s-apache-httpcodes"/>), onde é possível saber a quantidade de links
quebrados existentes em nosso servidor (estes poderão ser detectados usando o
pacote de análise de sites <systemitem role="package">linbot</systemitem>).  O
<command>webalizer</command> também é compatível com os formatos de log do
<command>squid</command> e <command>proftpd</command>.  Na distribuição
<command>Debian</command> ele pode ser instalado a partir do pacote <systemitem
role="package">webalizer</systemitem> e gera um relatório geral quando é
executado sem opções.
</para>
</section>

</section>

<section id="s-apache-proxy"><title>Configurando o Apache como servidor proxy</title>
<para>
O <command>Apache</command> pode ser configurado para funcionar como servidor
proxy transparente para sua rede interna, possibilitando inclusive o uso de
cache de disco.  É possível se fazer conexões HTTP (incluindo SSL) e FTP.
Através desta característica também é possível usar uma das características
mais interessante desse servidor web: o redirecionamento de conexões para uma
determinada URL para uma outra máquina, que pode ser um outro host remoto ou
uma máquina da rede interna (não acessível diretamente via Internet).
</para>
<para>
O primeiro passo é ativar o módulo de proxy no arquivo
<filename>httpd.conf</filename>, basta descomentar a linha:
</para>
<screen>
# LoadModule proxy_module /usr/lib/apache/1.3/libproxy.so
</screen>
<para>
O seguinte bloco pode ser colocado no final do arquivo
<filename>httpd.conf</filename> para configurar um servidor proxy para realizar
conexões diretas (sem o uso de cache) e permitir o uso de servidores proxy em
sua rede:
</para>
<screen>
# Suporte a Proxy
#
&lt;IfModule mod_proxy.c&gt;
  ProxyRequests off
  ProxyRemote * http://debian:3128
  ProxyBlock microsoft.com microsoft.com.br
  NoProxy 192.168.1.0/24
  ProxyDomain .gms.com.br

# Ativa/Desativa a manipulação de cabeçalhos HTTP/1.1 "Via:".
# 
# ("Full" adiciona a versão do servidor Apache; "Block" remove todos os cabeçalhos 
# de saída "Via:")
# Escolha uma das opções: Off | On | Full | Block
#
#ProxyVia On
#&lt;/IfModule&gt;
</screen>
<para>
Segue a explicação de cada uma das diretivas acima:
</para>
<variablelist>
<varlistentry>
<term>ProxyRequests [<emphasis>on/off</emphasis>]</term>
<listitem>
<para>
Ativa (on) ou Desativa (off) o serviço de proxy do servidor Apache.  Note que o
módulo <filename>libproxy.so</filename> deve estar carregado para que o bloco
&lt;IfModule libproxy.c&gt; seja processado.  A desativação desta diretiva não
afeta a diretiva <emphasis>ProxyPass</emphasis>.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ProxyRemote [<emphasis>origem</emphasis>] [<emphasis>URL</emphasis>]</term>
<listitem>
<para>
Esta opção é útil para fazer o Apache redirecionar suas requisições para outro
servidor proxy (como o <command>squid</command> ou o gateway da rede, caso o
Apache estiver sendo executado em uma máquina interna).  A
<emphasis>origem</emphasis> pode ser uma URL completa (como
http://www.debian.org), uma URL parcial (como ftp, http) ou "*" para que o
redirecionamento seja sempre usado.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ProxyBlock [<emphasis>padrão</emphasis>]</term>
<listitem>
<para>
Permite bloquear o acesso a endereços que contenham o
<emphasis>padrão</emphasis> especificado.  Podem ser especificadas palavras,
máquinas, domínios, URLs separados por espaços.  O <command>Apache</command>
fará a resolução DNS no caso de endereços IP e fará o cache para requisições
futuras.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>NoProxy [<emphasis>endereços</emphasis>]</term>
<listitem>
<para>
Permite especificar endereços Internos que não serão redirecionados para o
servidor proxy especificado por <emphasis>ProxyRemote</emphasis>.  Podem ser
usados nomes de máquinas, endereços IP, subredes ou domínios separados por
espaços.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ProxyDomain [<emphasis>endereço</emphasis>]</term>
<listitem>
<para>
Especifica o endereço que será adicionado a URL caso seja recebida uma
requisição que contenha somente um nome de máquina.  É útil em redes Internas.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
Note que quando o suporte a proxy não está ativado no
<command>Apache</command>, qualquer endereço de URL externa levará a página
definida pela diretiva <emphasis>DocumentRoot</emphasis>.  Isto deixará de
funcionar após configurar o serviço de proxy.
</para>
<para>
O uso do cache é interessante para acelerar as requisições http da rede interna
para a rede externa, desta forma, se uma requisição foi feita anteriormente,
será descarregado o arquivo do disco rígido e assim evitar uma nova conexão
externa (isto libera a rede para outras coisas).  Para configurar um cache no
serviço proxy, adicione as seguintes linhas no final do bloco anterior de
proxy:
</para>
<screen>
  # As linhas abaixo ativam o cache do apache, o cache não funcionará ao menos que
  # CacheRoot seja especificado
  CacheRoot /var/spool/apache
  CacheForceCompletion 70
  CacheSize 5
  CacheGcInterval 3
  CacheDefaultExpire 5
  CacheMaxExpire 300
  NoCache 192.168.1.0/24 a_domain.com outrodomínio.com.br outro.dominio.net
</screen>
<para>
Cada diretiva acima possui o seguinte significado:
</para>
<variablelist>
<varlistentry>
<term>CacheRoot</term>
<listitem>
<para>
Diretório base onde serão criados os outros diretórios de cache.  O cache só
será ativado se esta diretiva for definida.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>CacheForceCompletion [<emphasis>num</emphasis>]</term>
<listitem>
<para>
Se uma transferência for cancelada e passar de <emphasis>num</emphasis>%, o
<command>Apache</command> continuará a transferência e armazenará o arquivo no
cache.  O valor padrão é 90.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>CacheSize [<emphasis>num</emphasis>]</term>
<listitem>
<para>
Define o tamanho máximo do diretório de cache do <command>Apache</command>, em
KB.  Não especifique um valor que tome mais de 70% do espaço em disco.  O valor
padrão é 5.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>CacheGcInterval [<emphasis>num</emphasis>]</term>
<listitem>
<para>
Define o tempo que o cache será checado em busca de arquivos maiores que o
total do cache.  Arquivos que ultrapassem o tamanho do cache são
automaticamente eliminados.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>CacheDefaultExpire [<emphasis>num</emphasis>]</term>
<listitem>
<para>
Define o tempo que os documentos ficarão no cache, se foram transferidos
através de protocolos que não suportam horas de expiração.  O valor padrão é 1
hora.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>CacheMaxExpire [<emphasis>num</emphasis>]</term>
<listitem>
<para>
Define o tempo que os documentos permanecerão armazenados no cache (em horas).
Esta opção ignora a hora de expiração do documento (caso fornecida).  O valor
padrão é 24 horas.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>NoCache [<emphasis>endereços</emphasis>]</term>
<listitem>
<para>
Permite especificar lista de palavras, máquinas, domínios, IP's que não serão
armazenados no cache do <command>Apache</command>.  Caso seja usado
<literal>NoCache *</literal> o cache será desativado completamente.  Note que o
cache também pode ser desativado comentando a diretiva
<emphasis>CacheRoot</emphasis>.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
Se você desejar um servidor cache mais flexível, rápido, dinâmico, configurável
(com possibilidade de uso de restrições baseadas em URL, tempo de acesso,
autenticação), instale o <command>squid</command> e configure o
<command>apache</command> para fazer forward de conexões para ele (<xref
linkend="s-apache-proxy-redir"/>).
</para>
<section id="s-apache-proxy-access"><title>Controlando o acesso ao servidor proxy</title>
<para>
Incluir o bloco abaixo no arquivo <filename>access.conf</filename> para definir
o acesso dos serviços de proxy nas redes desejadas (se a sua configuração for
aberta como padrão isto pode ser opcional):
</para>
<screen>
# Acesso aos serviços proxy do apache
&lt;Directory proxy:*&gt;
    Order deny,allow
    Deny from all
    Allow from .seudominio.com.br
&lt;/Directory&gt;
</screen>
<para>
Para explicações sobre o processo de bloqueio acima, veja <xref
linkend="s-apache-acesso-restr-autor"/>.
</para>
</section>

<section id="s-apache-proxy-redir"><title>Redirecionamento de conexões no Apache</title>
<para>
Este recurso do <command>Apache</command> é interessante para criar clusters de
servidores em sua rede interna.  O que ele faz é pegar uma requisição a um
determinado endereço e redireciona-lo a outra máquina e as respostas são
repassadas ao servidor web (para o cliente a mesma máquina esta atendendo a
requisição, para você o processamento das requisições esta sendo distribuído
internamente na rede).
</para>
<para>
As seguintes diretivas são usadas para realizar o redirecionamento de conexões:
<emphasis>ProxyPass</emphasis> e <emphasis>ProxyPassReverse</emphasis>
</para>
<variablelist>
<varlistentry>
<term>ProxyPass [<emphasis>diretório_da_url</emphasis> [<emphasis>outro_servidor:/diretório</emphasis>]</term>
<listitem>
<para>
A <emphasis>ProxyPass</emphasis> permite que a URL seja redirecionada para o
servidor local e diretório especificado.  Por exemplo, assumindo que o endereço
principal de nosso servidor é <filename>http://www.guiafoca.org</filename> e
desejamos que a URL <filename>http://www.guiafoca.org/download</filename> seja
atendida por uma máquina localizada na nossa rede privada com o endereço
<filename>http://192.168.1.54</filename>.  Basta incluir a linha:
</para>
<screen>
ProxyPass /download http://192.168.1.54
</screen>
<para>
Qualquer requisição externa a
<filename>http://www.guiafoca.org/download/iniciante</filename> será atendida
por <filename>http://192.168.1.54/iniciante</filename>.
</para>
</listitem>
</varlistentry>
<varlistentry>
<term>ProxyPassRemote [<emphasis>diretório_da_url</emphasis> [<emphasis>outro_servidor:/diretório</emphasis>]</term>
<listitem>
<para>
Esta diretiva permite modificar o cabeçalho <literal>Location</literal> nas
mensagens de respostas de redirecionamento enviadas pelo
<command>Apache</command>.  Isto permite que o endereço retornado seja o do
servidor (que faz a interface externa com o cliente) e não da máquina do
redirecionamento.
</para>
<screen>
ProxyPass        /download http://192.168.1.54
ProxyPassReverse /download http://192.168.1.54
</screen>
<para>
Se a máquina <filename>192.168.1.54</filename> redirecionar a URL para
<filename>http://192.168.1.54/download/iniciante</filename>, a resposta será
modificada para <filename>http://www.guiafoca.org/download/iniciante</filename>
antes de ser retornada ao cliente.
</para>
</listitem>
</varlistentry>
</variablelist>
<para>
\
</para>
</section>

</section>

<section id="s-apache-vhosts"><title>Virtual Hosts</title>
<para>
Virtual Hosts (sites virtuais) é um recurso que permite servir mais de um site
no mesmo servidor.  Podem ser usadas diretivas específicas para o controle do
site virtual, como nome do administrador, erros de acesso a página, controle de
acesso e outros dados úteis para personalizar e gerenciar o site.  Existem 2
métodos de virtual hosts:
</para>
<itemizedlist>
<listitem>
<para>
<literal>Virtual Hosts baseados em IP</literal> - Requer um endereço IP
diferente para cada site.  Este poderá ser um IP real (da interface de rede) ou
um apelido (veja <xref linkend="cfgrede-ipalias"/>), o que interessa é que deve
haver um endereço IP diferente para cada site.  O número de sites servidos
estará limitado a quantidade de endereços IP disponíveis em sua classe de rede.
Veja <xref linkend="s-apache-vhosts-ip"/> para detalhes de como construir um
virtual host deste tipo.
</para>
<para>
O <command>apache</command> foi um dos primeiros servidores web a incluir
suporte a virtual hosts baseados em IP.
</para>
</listitem>
<listitem>
<para>
<literal>Virtual Hosts baseados em nome</literal> - Este utiliza nomes para
identificar os sites servidos e requerem somente um endereço IP.  Desta maneira
é possível servir um número ilimitado de sites virtuais.  O navegador do
cliente deve suportar os cabeçalhos necessários para garantir o funcionamento
deste recurso (praticamente todos os navegadores atuais possuem este suporte).
Veja <xref linkend="s-apache-vhosts-nome"/> para detalhes de como construir um
virtual host deste tipo.
</para>
</listitem>
</itemizedlist>
<para>
As explicações desta seção são baseadas na documentação do
<command>Apache</command>.
</para>
<section id="s-apache-vhosts-ip"><title>Virtual hosts baseados em IP</title>
<para>
Existem duas maneiras de rodar este tipo de host virtual: Através de daemons
<command>httpd</command> separados ou em um único daemon
<command>httpd</command> usando a diretiva &lt;VirtualHost&gt;.
</para>
<para>
As vantagens do uso de <emphasis>daemons separados</emphasis> para servir
requisições é a proteção sob <emphasis>UID</emphasis> e
<emphasis>GID</emphasis> diferente dos outros servidores, assim o administrador
do <emphasis>site1</emphasis> não terá acesso ao
<filename>httpd.conf</filename>, página do <filename>site2</filename> (porque
ele estará rodando sob uma <emphasis>UID</emphasis> e <emphasis>GID</emphasis>
diferentes e o acesso é restrito).  Para usar este método, especifique a opção
<emphasis>-f [arquivo_cfg]</emphasis> para utilizar um arquivo de configuração
personalizado e a diretiva <emphasis>Listen endereço:porta</emphasis> para
dizer onde o servidor aguardará as requisições.
</para>
<para>
As vantagens do uso de um <emphasis>mesmo daemon</emphasis> para servir as
requisições são: quando não há problema se os administradores de outros sites
tenham acesso ao mesmo arquivo de configuração ou quando há a necessidade de
servir muitas requisições de uma só vez (quanto menos servidores web estiverem
em execução, melhor o desempenho do sistema).  Abaixo um exemplo de
configuração de virtual hosts servindo os sites
<literal>www.site1.com.br</literal> e <literal>www.site2.com.br</literal>:
</para>
<screen>
ServerAdmin webmaster@site.com.br

&lt;VirtualHost www.site1.com.br&gt;
 ServerName www.site1.com.br
 ServerAdmin site1@site1.com.br
 DocumentRoot /var/www/www_site1_com_br
 TransferLog /var/log/apache/site1/access.log
 ErrorLog /var/log/apache/site1/error.log
 User www-data
 Group www-data
&lt;/VirtualHost&gt;

&lt;VirtualHost www.site2.com.br&gt;
 ServerName www.site2.com.br
 DocumentRoot /var/www/www_site2_com_br
 CustomLog /var/log/apache/site2/access.log combined
 ErrorLog /var/log/apache/site2/error.log
&lt;/VirtualHost&gt;
</screen>
<para>
Qualquer diretiva dentro de &lt;VirtualHost&gt; controlarão terão efeito no
site virtual especificado.  Quando uma diretiva não for especificada dentro de
&lt;VirtualHost&gt;, serão usados os valores padrões especificados no arquivo
de configuração do <command>Apache</command> (como a diretiva
<emphasis>ServerAdmin webmaster@site.com.br</emphasis> que será usado como
padrão na configuração de <emphasis>www.site2.com.br</emphasis>).
</para>
<para>
Digite <literal>apache -S</literal> para ver suas configurações de virtual
hosts atual.
</para>
<para>
<emphasis role="strong">OBS1:</emphasis> Desative a diretiva
<literal>UseCanonicalName off</literal> quando utilizar o recurso de máquinas
virtuais, esta diretiva faz que o nome do servidor retornado usando o valor em
<literal>ServerName</literal> quando o cliente digita um endereço qualquer.
</para>
<para>
<emphasis role="strong">OBS2:</emphasis> Utilize sempre que possível endereços
IP em configurações críticas, assim os serviços não serão tão vulneráveis a
possíveis falsificações ou erros.  Veja <xref linkend="rede-dns-a-hostconf"/> e
<xref linkend="fw-iptables-outras-ipspoof"/>.  Leia também a seção <xref
linkend="s-apache-vhosts-dnssec"/>.
</para>
<para>
<emphasis role="strong">OBS3:</emphasis> Não permita que outros usuários a não
ser o root e o dono do processo <command>Apache</command> (especificado pela
diretiva <emphasis>User</emphasis>) tenham acesso de gravação aos logs gerados
pelo servidor, pois os dados podem ser apagados ou criados links simbólicos
para binários do sistema que serão destruídos quando o
<command>Apache</command> gravar dados.  Alguns binários e bibliotecas são
essenciais para o funcionamento do sistema.
</para>
</section>

<section id="s-apache-vhosts-nome"><title>Virtual hosts baseados em nome</title>
<para>
Este método é idêntico ao baseado em IP, em especial adicionamos a diretiva
<emphasis>NameVirtualHost</emphasis> para dizer qual é o endereço IP do
servidor que está servindo os virtual hosts baseados em nome.  Veja o exemplo
de configuração:
</para>
<screen>
NameVirtualHost 200.200.200.10:80

&lt;VirtualHost _default_:80 200.200.200.10:80&gt;
 ServerName www.site.com.br
 ServerAdmin admin@site.com.br
 DocumentRoot /var/www
 TransferLog /var/log/apache/access.log
 ErrorLog /var/log/apache/error.log
&lt;/VirtualHost&gt;

&lt;VirtualHost 200.200.200.10&gt;
 ServerName www.site1.com.br
 ServerAdmin admin1@site1.com.br
 DocumentRoot /var/www/www_site1_com_br
 TransferLog /var/log/apache/site1/access.log
 ErrorLog /var/log/apache/site1/error.log
&lt;/VirtualHost&gt;

&lt;VirtualHost 200.200.200.10&gt;
 ServerName www.site2.com.br
 ServerAdmin admin2@site2.com.br
 DocumentRoot /var/www/www_site2_com_br
 TransferLog /var/log/apache/site2/access.log
 ErrorLog /var/log/apache/site2/error.log
&lt;/VirtualHost&gt;
</screen>
<para>
A diretiva <emphasis>NameVirtualHost</emphasis> diz que será usado virtual
hosts baseados em nome servidos pela máquina com IP
<literal>200.200.200.10</literal>.  Os parâmetros dentro do bloco das diretivas
&lt;VirtualHost &gt; são específicas somente no site virtual especificado, caso
contrário os valores padrões definidos no arquivo de configuração serão usados.
Caso nenhum virtual host confira com a configuração, o virtualhost
<emphasis>_default_</emphasis> será usado.
</para>
<para>
Digite <literal>apache -S</literal> para ver suas configurações de virtual
hosts atual.  Se sua intenção é criar um grande número de virtual hosts que
serão servidos pela mesma máquina, o uso da expansão <literal>%0</literal> e
diretivas <literal>VirtualDocumentRoot</literal> e
<literal>VirtualScriptAlias</literal> são recomendados:
</para>
<screen>
NameVirtualHost 200.200.200.10:80

&lt;VirtualHost 200.200.200.10&gt;
 VirtualDocumentRoot /var/www/%0
 VirtualScriptAlias /var/www/%0/cgi-bin
 TransferLog log/apache/site1/access.log
 ErrorLog log/apache/site1/error.log
&lt;/VirtualHost&gt;
</screen>
<para>
Agora crie os diretórios em <filename>/var/www</filename> correspondentes aos
nomes de domínios que serão servidos por sua máquina: <literal>mkdir
/var/www/www.site1.com.br</literal>, <literal>mkdir
/var/www/www.site2.com.br</literal>.  Note que sua máquina deverá estar com o
DNS configurado para responder por estes domínios .
</para>
<para>
<emphasis role="strong">ATENÇÃO</emphasis> É importante que os endereços
especificados nas diretivas <emphasis>ServerName</emphasis>
(<literal>www.site1.com.br</literal>) resolvam o endereço IP da diretiva
<emphasis>VirtualHost</emphasis> (<filename>200.200.200.10</filename>).  Isto
deve ser feito via DNS ou nos arquivos <filename>/etc/hosts</filename>.
</para>
<para>
<emphasis role="strong">OBS1:</emphasis> Utilize sempre que possível endereços
IP em configurações críticas, assim os serviços não serão tão vulneráveis a
possíveis falsificações ou erros.  Veja <xref linkend="rede-dns-a-hostconf"/> e
<xref linkend="fw-iptables-outras-ipspoof"/>.  Leia também a seção <xref
linkend="s-apache-vhosts-dnssec"/>.
</para>
<para>
<emphasis role="strong">OBS2:</emphasis> Não permita que outros usuários a não
ser o root e o dono do processo <command>Apache</command> (especificado pela
diretiva <emphasis>User</emphasis>) tenha acesso de gravação aos logs gerados
pelo servidor.  Pois os dados podem ser apagados ou criados links para binários
do sistema que serão destruídos quando o apache gravar dados para os logs.
Alguns binários e bibliotecas são essenciais para o funcionamento do sistema.
</para>
</section>

<section id="s-apache-vhosts-dnssec"><title>Segurança no uso de IP's em Virtual Hosts</title>
<para>
Quando você está colocando um nome na diretiva de configuração do seu virtual
hosts, está assumindo que ele resolverá o endereço IP corretamente (como
<literal>www.site1.com.br</literal> =&gt; <literal>200.200.200.10</literal>).
Se por algum motivo o servidor DNS for modificado (por outra pessoa que tem
acesso a isto), o endereço IP resolvido para o site
<literal>www.site1.com.br</literal> poderá ser modificado para
<literal>200.200.200.20</literal>, isto redirecionará as requisições para outra
máquina ao invés da máquina correta.  Este tipo de ataque é chamado "DNS
Spoofing" e o uso de endereço IP (ao invés de nomes) praticamente evita que
isto aconteça.  Esta situação pode acontecer com a diretiva abaixo:
</para>
<screen>
&lt;VirtualHost www.gms.com.br&gt;
 ServerName www.gms.com.br
 ServerAdmin gleydson@guiafoca.org
 DocumentRoot /var/www/www_gms_com_br
&lt;/VirtualHost&gt;
</screen>
<para>
Outra situação, que impede o funcionamento do servidor Web, é quando o servidor
DNS está em manutenção ou por algum outro motivo não pode resolver o endereço
IP de um nome especificado (como <literal>www.site1.com.br</literal>).  O
<command>apache</command> precisa saber qual é o seu endereço IP para ser
executado.  Veja a próxima modificação:
</para>
<screen>
&lt;VirtualHost 192.168.1.1&gt;
 ServerName www.gms.com.br
 ServerAdmin gleydson@guiafoca.org
 DocumentRoot /var/www/www_gms_com_br
&lt;/VirtualHost&gt;
</screen>
<para>
Na configuração acima usamos o IP do servidor para especificar o virtual host.
O <command>apache</command> tentará fazer o DNS reverso para determinar qual
nome é servido por aquele endereço IP (<literal>www.site1.com.br</literal>).
Se ele falhar, somente a seção &lt;VirtualHost&gt; correspondente será
desativada.  Isto já é uma melhoria sobre a primeira configuração.  O nome do
servidor na diretiva <emphasis>ServerName</emphasis> garante que o servidor
responda com o nome correto.
</para>
<para>
Para evitar ataques baseados em DNS siga os seguintes procedimentos de
segurança:
</para>
<orderedlist numeration="arabic">
<listitem>
<para>
Preferencialmente utilize o arquivo <filename>/etc/hosts</filename> para a
resolução de nomes em máquinas locais (principalmente quando existe somente um
administrador).  É um método que evita diversas consultas ao servidor DNS (que
pode deixar o acesso lento) e este arquivo é gerenciado pelo usuário
<literal>root</literal>, isto evita o acesso de qualquer usuário para a
falsificação de endereços.
</para>
<para>
Este arquivo também é útil caso a pesquisa DNS falhe (quando a ordem de
pesquisa for do servidor DNS para o arquivo <filename>hosts</filename> no
arquivo <filename>/etc/host.conf</filename>), pois de qualquer forma o nome
será resolvido e o servidor <command>Apache</command> será executado.
</para>
</listitem>
<listitem>
<para>
Evite dar poderes a outros administradores manipularem seu próprio domínio DNS,
não há nada que possa impedi-lo de modificar o endereço "X" para ser servido
pelo IP "Y" desviando o tráfego para seu próprio servidor web.  Se isto não for
possível, siga as dicas abaixo para diminuir possíveis problemas.
</para>
</listitem>
<listitem>
<para>
Utilize endereços IP na diretiva &lt;VirtualHost&gt;.
</para>
</listitem>
<listitem>
<para>
Use endereços IP na diretiva <emphasis>Listen</emphasis>.
</para>
</listitem>
<listitem>
<para>
Use um endereço IP na diretiva <emphasis>BindAddress</emphasis>.
</para>
</listitem>
<listitem>
<para>
Sempre utilize o parâmetro <emphasis>ServerName</emphasis> em todas as
diretivas &lt;VirtualHost&gt;, isto evita o retorno incorreto de nomes (que
pode evitar/revelar fraudes).
</para>
</listitem>
<listitem>
<para>
Quando utilizar virtual hosts, crie uma diretiva &lt;VirtualHost
_default_L:*&gt; usando uma diretiva <emphasis>DocumentRoot</emphasis> que não
aponte para lugar algum.  Esta diretiva será acessada quando nenhuma diretiva
<emphasis>VirtualHost</emphasis> servir a requisição, conferindo com o
endereço/ip.
</para>
</listitem>
</orderedlist>
</section>

</section>

<section id="s-apache-ssl"><title>Uso de criptografia SSL</title>
<para>
Esta seção é uma referência rápida para configuração e uso do módulo
<filename>apache-ssl</filename> com o servidor <command>Apache</command>.  Este
módulo realiza a comunicação segura de dados (criptografada) via porta 443 (que
é usada como padrão quando especificamos uma url iniciando com
<emphasis>https://</emphasis>).  A transmissão criptografada de dados é
importante quanto temos dados confidenciais que precisamos transmitir como
movimentação bancária, senhas, número de cartões de crédito, fazer a
administração remota do servidor, etc.  SSL significa <emphasis>Secure Sockets
Layer</emphasis> (camada segura de transferência) e TLS <emphasis>Transport
Layer Security</emphasis> (camada segura de Transporte).
</para>
<para>
A intenção aqui é fornecer explicações práticas para colocar um servidor
<command>Apache</command> com suporte a SSL funcionando no menor tempo
possível.  Detalhes sobre funcionamento de certificados, métodos de
criptografia, assinatura, etc.  deverão ser buscados na documentação deste
módulo ou em sites especializados (é um assunto muito longo).
</para>
<section id="s-apache-ssl-s"><title>Servidor apache com suporte a ssl</title>
<para>
Ao invés de utilizar o módulo <filename>mod_ssl</filename>, você poderá usar o
pacote <systemitem role="package">apache-ssl</systemitem>, ele nada mais é que
um servidor <command>Apache</command> com o suporte SSL já incluso e não
interfere no servidor <command>Apache</command> padrão, porque é executado
somente na porta 443.
</para>
<para>
Se você tem um grande site com configurações de acesso personalizadas, ele
trará mais trabalho de administração, pois as configurações e diretivas de
restrições de acesso deverão ser copiadas para este servidor web.  No entanto,
ele é indicado para máquinas que serão servidores SSL dedicados ou quando não
possui configurações especiais em seu servidor web principal.
</para>
<para>
Esta seção tem por objetivo a instalação do suporte ao módulo SSL
(<filename>mod_ssl</filename>) no servidor <command>Apache</command> padrão.
</para>
</section>

<section id="s-apache-ssl-instal"><title>Instalando o suporte a módulo SSL no Apache</title>
<para>
Instale o pacote <systemitem role="package">libapache-mod-ssl</systemitem>.
Após instala-lo, edite o arquivo <filename>/etc/apache/httpd.conf</filename>
adicionando a linha:
</para>
<screen>
LoadModule ssl_module /usr/lib/apache/1.3/mod_ssl.so
</screen>
<para>
Depois, gere um certificado digital ssl com o programa
<command>mod-ssl-makecert</command>.  Ele será armazenado por padrão nos
diretórios em <filename>/etc/apache/ssl.???</filename> e seu uso explicado no
resto desta seção.
</para>
</section>

<section id="s-apache-ssl-mkcert"><title>Gerando um certificado digital</title>
<para>
O certificado digital é a peça que garante a transferência segura de dados.
Ele contém detalhes sobre a empresa que fará seu uso e quem o emitiu.  Para
gerar ou modificar um certificado digital, execute o comando
<literal>mod-ssl-makecert</literal> e siga as instruções.  O método de
criptografia usado pelo certificado digital é baseado no conceito de chave
pública/privada, a descrição sobre o funcionamento deste sistema de
criptografia é feito em <xref linkend="d-cripto-gpg"/>.
</para>
<para>
<emphasis role="strong">OBS</emphasis> Não utilize acentos nos dados de seu
certificado.
</para>
</section>

<section id="s-apache-ssl-exemplo"><title>Exemplo de configuração do módulo mod-ssl</title>
<para>
Abaixo uma configuração rápida para quem deseja ter um servidor com suporte a
SSL funcionando em menor tempo possível (ela é feita para operar em todas as
instalações e não leva em consideração o projeto de segurança de sua
configuração atual do <command>Apache</command>).  Note que todas as diretivas
relacionadas com o módulo <filename>mod_ssl</filename> começam com o nome
"SSL":
</para>
<screen>
# Somente processa as diretivas relacionadas a SSL caso o módulo mod_ssl estiver
# carregado pela diretiva LoadModule
&lt;IfModule mod_ssl.c&gt;
# É necessário especificar as portas que o servidor Web aguardará conexões (normais e 
# ssl). 
Listen 80
Listen 443

# Ativa o tratamento de conexões com o destino na porta 443 pela diretiva
# VirtualHost abaixo
&lt;VirtualHost _default_:443&gt;

# Ativa ou desativa o módulo SSL para este host virtual
SSLEngine on

# Certificado do servidor
SSLCertificateFile    /etc/apache/ssl.crt/server.crt

# Chave privada de certificado do servidor. 
SSLCertificateKeyFile /etc/apache/ssl.key/server.key

# A linha abaixo força o fechamento de conexões quando a 
# conexão com o navegador Internet Explorer é interrompida. Isto
# viola o padrão SSL/TLS mas é necessário para este tipo de 
# navegador. Alguns problemas de conexões de navegadores também
# são causados por não saberem lidar com pacotes keepalive.
SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown

&lt;/VirtualHost&gt;

&lt;/IfModule&gt;

#################################################################################
# Adicionalmente poderão ser especificadas as seguintes opções para modificar   #
# o comportamento da seção SSL (veja mais detalhes na documentação do mod-ssl)  #
#################################################################################

# Formato e localização do cache paralelo de processos da seção. O cache de seção é 
# feito internamente pelo módulo mas esta diretiva acelera o processamento 
# de requisições paralelas feitas por modernos clientes navegadores. Por padrão 
# nenhum cache é usado ("none"). 
SSLSessionCache         dbm:/var/run/ssl-cache

# Localização do arquivo de lock que o módulo SSL utiliza para 
# sincronização entre processos. O padrão é nenhum. 
SSLMutex  file:/var/run/ssl-mutex

# Especifica o método de embaralhamento de dados que será utilizado
# durante o inicio de uma seção SSL (startup) ou durante o processo 
# de conexão (connect). Podem ser especificados "builtin" (é muito rápido 
# pois consome poucos ciclos da CPU mas não gera tanta combinação aleatória), um 
# programa que gera números aleatórios (com "exec") ou os dispositivos aleatórios 
# /dev/random e /dev/urandom (com "file"). Por padrão nenhuma fonte 
# adicional de números aleatórios é usada. 
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
#SSLRandomSeed startup file:/dev/urandom 512
#SSLRandomSeed connect file:/dev/urandom 512
#SSLRandomSeed connect exec:/pub/bin/NumAleat

# Tipos MIME para download de certificados
AddType application/x-x509-ca-cert .crt
AddType application/x-pkcs7-crl    .crl

# Tempo máximo de permanência dos objetos do cache acima. O valor padrão é 
# 300 segundos (5 minutos).
SSLSessionCacheTimeout  300

# Versão do protocolo SSL que será usada. Podem ser especificadas 
# SSLv2, SSLv3 TLSv1 ou all. O mais compatível com os navegadores atuais 
# é o "SSLv2". Por padrão "all" é usado.
#SSLProtocol all
#SSLProtocol -all +SSLv3

# Registra detalhes sobre o tráfego neste arquivo. Mensagens de erro 
# também são armazenadas no arquivo de registro padrão do Apache
SSLLog      /var/log/apache/ssl-mod.log

# Nível das mensagens de log registradas por SSLLog
SSLLogLevel info
</screen>
<para>
Algumas diretivas deste módulo podem fazer parte tanto da configuração global
do servidor como diretivas de acesso (<literal>Directory</literal>,
<literal>Location</literal>, <literal>.htaccess</literal>, veja a opção
"Context" na documentação do <filename>mod_ssl</filename>).
</para>
</section>

<section id="s-apache-ssl-sslreq"><title>Autorizando acesso somente a conexões SSL</title>
<para>
Existem casos que precisa restringir o uso de conexões normais e permitir
somente conexões via SSL (como por exemplo, dentro da diretiva de acesso que
controla seu acesso a uma página com listagem de clientes).  A opção
<emphasis>SSLRequereSSL</emphasis> é usada para tal e deve ser usada dentro das
diretivas de controle acesso:
</para>
<screen>
&lt;Directory /var/www/secure/clientes&gt;
 Options Indexes 
 Order deny,allow
 Deny from evil.cracker.com
 SSLRequireSSL
&lt;/Directory&gt;
</screen>
<para>
A diretiva acima <emphasis>requer</emphasis> que sejam feitas conexões SSL
(porta 443 - https://) para acesso ao diretório
<filename>/var/www/secure/clientes</filename>, qualquer conexão padrão não
criptografada (feita na porta 80) será rejeitada com o erro 403.
</para>
<para>
<emphasis role="strong">OBS:</emphasis> A diretiva
<emphasis>SSLRequireSSL</emphasis> podia ser colocada entre as condicionais
"IfModule mod_ssl.c" mas o servidor web permitiria conexões não criptografadas
se por algum motivo esse módulo não estivesse carregado.  Na configuração
acima, ocorrerá um erro e impedirá o funcionamento do servidor web caso ocorra
algum problema com o <filename>mod_ssl</filename>.
</para>
</section>

<section id="s-apache-ssl-inic"><title>Iniciando o servidor Web com suporte a SSL</title>
<para>
Verifique se a configuração do <command>Apache</command> está ok com
<literal>apache -t</literal>.  Caso positivo, reinicie o servidor usando um dos
métodos descritos em <xref linkend="s-apache-rodando"/>.  O servidor web lhe
pedirá a FraseSenha para descriptografar a chave privada SSL (esta senha foi
escolhida durante o processo de criação do certificado).
</para>
<para>
Esta senha garante uma segurança adicional caso a chave privada do servidor
seja copiada de alguma forma.  Somente quem tem conhecimento da FraseSenha
poderá iniciar o servidor com suporte a transferência segura de dados.
Verifique se o virtual host está servindo as requisições na porta 443 com
<literal>apache -S</literal>.
</para>
<para>
O único método para fazer o servidor web evitar de pedir a senha para
descriptografar a chave privada é colocando uma senha em branco.  Isto só é
recomendado em ambientes seguros e o diretório que contém a chave privada
deverá ter somente permissões para o dono/grupo que executa o servidor Web.
Qualquer outra permissão poderá por em risco a segurança da instalação caso a
chave privada seja roubada.  Depois disso, execute o comando:
</para>
<screen>
# entre no diretório que contém a chave privada
cd /etc/apache/ssl.key
# renomeie a chave privada para outro nome
ren server.key server.key-Csenha
openssl rsa -in server.key-Csenha -out server.key
</screen>
<para>
Digite a senha quando pedido.  A chave original (com senha) estará gravada no
arquivo <filename>server.key-Csenha</filename> e poderá ser restaurada se
necessário.  Reinicie o servidor <command>Apache</command>, desta vez ele não
pedirá a senha.
</para>
<para>
<emphasis role="strong">OBS1:</emphasis> Tire uma cópia de segurança da chave
privada original antes de executar esta operação.
</para>
<para>
<emphasis role="strong">OBS2:</emphasis> Não se esqueça de ajustar as
permissões de acesso no diretório <filename>/etc/apache/ssl.key</filename> caso
não utilize senha para proteger seu certificado digital.
</para>
</section>

</section>

<section id="s-apache-exemplo"><title>Exemplo comentado de um arquivo de configuração do Apache</title>
<para>
O exemplo abaixo foi retirado da distribuição <command>Debian
GNU/Linux</command>, fiz sua tradução, modificações e inclui alguns comentários
sobre as diretivas para deixa-lo mais de acordo com o conteúdo abordado pelo
guia e mais auto-explicativo.
</para>
<para>
A configuração do <command>Apache</command> está distribuída nos arquivos
<filename>httpd.conf</filename>, <filename>srm.conf</filename> e
<filename>access.conf</filename> e podem ser usados como modelo para a
construção da configuração de seu servidor.
</para>
<section id="s-apache-exemplo-httpd"><title>httpd.conf</title>
<screen>
##
## httpd.conf -- Arquivo de configuração do servidor httpd Apache
##

#
# Baseado nos arquivos de configuração originais do servidor NCSA por Rob McCool.
# Modificado para distribuição junto ao guia Foca GNU/Linux Avançado
# http://focalinux.cipsga.org.br/ &lt;gleydson@guiafoca.org&gt;
#
# Este é o arquivo de configuração principal do servidor Apache. Ele contém as
# diretivas de configuração que dão ao servidor suas instruções.
# Veja &lt;http://www.apache.org/docs/&gt; para informações detalhadas sobre as 
# diretivas.
#
# NÃO leia simplesmente as instruções deste arquivo sem entender o que significam
# e o que fazem, se não tiver certeza do que está fazendo consulte a documentação
# on-line ou leia as seções apropriadas do guia. Você foi avisado.
#
# Após este arquivo ser processado, o servidor procurará e processará o arquivo
# /etc/apache/srm.conf e então /etc/apache/access.conf
# a não ser que você tenha modificado o nome dos arquivos acima através das 
# diretivas ResourceConfig e/ou AccessConfig neste arquivo.
#
# Configuração e nomes de arquivos de log: Se os nomes de arquivos que 
# especificar para os arquivos de controle do servidor iniciam com uma 
# "/", o servidor usará aquele caminho explicitamente. Se os nomes *não*
# iniciarem com uma "/", o valor de ServerRoot é adicionado -- assim 
# "logs/foo.log" com ServerRoot ajustado para "/usr/local/apache" será 
# interpretado pelo servidor como "/usr/local/apache/logs/foo.log".
#
# Originalmente por Rob McCool
# modificado por Gleydson Mazioli da Silva para o guia Foca GNU/Linux

# Carga dos Módulos de Objetos Compartilhados:
# Para você ser capaz de usa a funcionalidade de um módulo que foi construído como
# um módulo compartilhado, será necessário adicionar as linhas 'LoadModule'
# correspondente a sua localização, assim as diretivas que os módulos contém
# estarão disponíveis _antes_ de serem usadas. 
# Exemplo:

#
# ServerType pode ser inetd, ou standalone.  O modo Inetd somente é suportado nas 
# plataformas Unix. O modo standalone inicia o servidor como um daemon.
#

ServerType standalone

# Se estiver executando a partir do inetd, vá até a diretiva "ServerAdmin".

# Port: A porta que o servidor standalone escutará. Para portas &lt; 1023, será 
# necessário o servidor funcionando como root inicialmente.

Port 80

#
# HostnameLookups: Registra os nomes DNS dos clientes ou apenas seus endereços
# IP's
# ex., www.apache.org (on) ou 204.62.129.132 (off).
# O valor padrão é off porque permitirá menos tráfego na rede. Ativando
# esta opção significa que cada acesso de um cliente resultará em 
# NO MÍNIMO uma requisição de procura ao servidor de nomes (DNS).
#

HostnameLookups off

# Caso desejar que o servidor http seja executado como um usuário ou grupo diferente
# você deve executar o httpd inicialmente como root e ele modificará sua ID para a 
# especificada.  

# User/Group: O nome (ou #número) do usuário/grupo que executará o servidor httpd.
# No SCO (ODT 3) use "User nouser" e "Group nogroup"
# No HPUX você pode não será capaz de usar memória compartilhada como nobody, e 
# é sugerido que seja criado um usuário www e executar o servidor httpd como 
# este usuário, adequando as permissões onde necessárias.

User www-data
Group www-data

# ServerAdmin: Seu endereço de e-mail, onde os problemas com o servidor devem ser 
# enviadas. Este endereço aparecerá nas mensagens de erro do servidor.
ServerAdmin gleydson@guiafoca.org

#
# ServerRoot: O topo da árvore de diretórios onde os arquivos de configuração do 
# servidor, erros, e log são mantidos.
#
# NOTA: Se tiver a intenção de colocar isto em um sistema de arquivos montado 
# em um servidor NFS (ou outra rede) então por favor leia a documentação do 
# LockFile 
# (disponível em &lt;http://www.apache.org/docs/mod/core.html#lockfile&gt;);
# e se salvará de vários problemas.
#
# Não adicione uma barra no fim do caminho do diretório.
#

ServerRoot /etc/apache

# BindAddress: Você pode usar esta opção em virtual hosts. Esta
# opção é usada para dizer ao servidor que endereço IP escutar. Ele pode 
# conter ou "*", um endereço IP, ou um nome de domínio completamente qualificado
# (FQDN). Veja também a diretiva VirtualHost.

BindAddress *

#
# Suporte a Objetos Compartilhados Dinamicamente (DSO - Dynamic Shared Object)
#
# Para ser capaz de usar a funcionalidade de um módulo que foi compilado como 
# um módulo DSO, você terá que adicionar as linhas 'LoadModule' correspondentes
# nesta localização, assim as diretivas contidas nela estarão disponíveis 
# _antes_ de serem usadas. Por favor leia o arquivo README.DSO na distribuição
# 1.3 do Apache para mais detalhes sobre o mecanismo DSO e execute o comando
# "apache -l" para a lista de módulos já compilados (estaticamente linkados e 
# assim sempre disponíveis) em seu binário do Apache.
#
# Please keep this LoadModule: line here, it is needed for installation.
# LoadModule vhost_alias_module /usr/lib/apache/1.3/mod_vhost_alias.so
# LoadModule env_module /usr/lib/apache/1.3/mod_env.so
LoadModule config_log_module /usr/lib/apache/1.3/mod_log_config.so
# LoadModule mime_magic_module /usr/lib/apache/1.3/mod_mime_magic.so
LoadModule mime_module /usr/lib/apache/1.3/mod_mime.so
LoadModule negotiation_module /usr/lib/apache/1.3/mod_negotiation.so
LoadModule status_module /usr/lib/apache/1.3/mod_status.so
# LoadModule info_module /usr/lib/apache/1.3/mod_info.so
# LoadModule includes_module /usr/lib/apache/1.3/mod_include.so
LoadModule autoindex_module /usr/lib/apache/1.3/mod_autoindex.so
LoadModule dir_module /usr/lib/apache/1.3/mod_dir.so
LoadModule php3_module /usr/lib/apache/1.3/libphp3.so
LoadModule cgi_module /usr/lib/apache/1.3/mod_cgi.so
# LoadModule asis_module /usr/lib/apache/1.3/mod_asis.so
# LoadModule imap_module /usr/lib/apache/1.3/mod_imap.so
# LoadModule action_module /usr/lib/apache/1.3/mod_actions.so
# LoadModule speling_module /usr/lib/apache/1.3/mod_speling.so
LoadModule userdir_module /usr/lib/apache/1.3/mod_userdir.so
LoadModule alias_module /usr/lib/apache/1.3/mod_alias.so
LoadModule rewrite_module /usr/lib/apache/1.3/mod_rewrite.so
LoadModule access_module /usr/lib/apache/1.3/mod_access.so
LoadModule auth_module /usr/lib/apache/1.3/mod_auth.so
# LoadModule anon_auth_module /usr/lib/apache/1.3/mod_auth_anon.so
# LoadModule dbm_auth_module /usr/lib/apache/1.3/mod_auth_dbm.so
# LoadModule db_auth_module /usr/lib/apache/1.3/mod_auth_db.so
# LoadModule proxy_module /usr/lib/apache/1.3/libproxy.so
# LoadModule digest_module /usr/lib/apache/1.3/mod_digest.so
# LoadModule cern_meta_module /usr/lib/apache/1.3/mod_cern_meta.so
LoadModule expires_module /usr/lib/apache/1.3/mod_expires.so
# LoadModule headers_module /usr/lib/apache/1.3/mod_headers.so
# LoadModule usertrack_module /usr/lib/apache/1.3/mod_usertrack.so
LoadModule unique_id_module /usr/lib/apache/1.3/mod_unique_id.so
LoadModule setenvif_module /usr/lib/apache/1.3/mod_setenvif.so
# LoadModule sys_auth_module /usr/lib/apache/1.3/mod_auth_sys.so
# LoadModule put_module /usr/lib/apache/1.3/mod_put.so
# LoadModule throttle_module /usr/lib/apache/1.3/mod_throttle.so
# LoadModule allowdev_module /usr/lib/apache/1.3/mod_allowdev.so
# LoadModule auth_mysql_module /usr/lib/apache/1.3/mod_auth_mysql.so
# LoadModule pgsql_auth_module /usr/lib/apache/1.3/mod_auth_pgsql.so
# LoadModule eaccess_module /usr/lib/apache/1.3/mod_eaccess.so
# LoadModule roaming_module /usr/lib/apache/1.3/mod_roaming.so

#
# ExtendedStatus: Controla de o Apache gerará detalhes completos de status
# (ExtendedStatus On) ou apenas detalhes básicos (ExtendedStatus Off) quando o 
# manipulador (handler) "server-status" for usado. O padrão é Off.
#
ExtendedStatus on

#
# ErrorLog: A localização do arquivo de log de erros.
# Se não estiver especificando a diretiva ErrorLog dentro de &lt;VirtualHost&gt;, 
# as mensagens de erros relativas aos hosts virtuais serão registradas neste 
# arquivo. Se definir um arquivo de log de erros para &lt;VirtualHost&gt;, as 
# mensagens relativas ao servidor controlados por ela serão registradas lá e 
# não neste arquivo.
#
ErrorLog /var/log/apache/error.log

#
# LogLevel: Controla o número de mensagens registradas no ErrorLog.
# Facilidades possíveis incluem: debug, info, notice, warn, error, crit,
# alert, emerg.
# Veja as facilidades na seção do guia sobre o syslog para detalhes
#
LogLevel warn

# As seguintes diretivas definem alguns formatos de nomes que serão usadas com a 
# diretiva CustomLog (veja abaixo).

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %T %v" full
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %P %T" debug
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

#
# A localização e formato do arquivo de log de acesso (definida pela diretiva 
# LogFormat acima).
# Se não definir quaisquer arquivos de log de acesso dentro de um 
# &lt;VirtualHost&gt;, elas serão registradas aqui. Se for definida dentro
# de &lt;VirtualHost&gt; o arquivo de log de acesso será registrado no 
# arquivo especificado na diretiva e não aqui.
#
#CustomLog /var/log/apache/access.log common

# Se você desejar ter um arquivo de log separado para o agent (navegador usado) 
# e referer, descomente as seguintes diretivas.

#CustomLog /var/log/apache/referer.log referer
#CustomLog /var/log/apache/agent.log agent

# Se preferir um arquivo de log simples, com os detalhes de acesso, agent, e 
# referer (usando o formato combined da diretiva LogFile acima), use a seguinte
# diretiva.

CustomLog /var/log/apache/access.log combined

#
# Incluir uma linha contendo a versão do servidor e um nome de host virtual
# para as páginas geradas pelo servidor (documentos de erro, listagens 
# de diretórios FTP, saída dos módulos mod_status e mod_info, etc., exceto 
# para documentos gerados via CGI). Use o valor "EMail" para também incluir 
# um link mailto: para o ServerAdmin. Escolha entre "On", "Off" ou "EMail".
#
ServerSignature On

#
# PidFile: O arquivo que o servidor gravará os detalhes sobre seu PID quando 
# iniciar.
#
PidFile /var/run/apache.pid

#
# ScoreBoardFile: Arquivo usado para armazenar detalhes do processo interno do 
# servidor. Nem todas as arquiteturas requerem esta diretiva, mas se a sua 
# requerer (você saberá porque este arquivo será criado quando executar o 
# Apache) então você *deverá* ter certeza que dois processos do Apache não
# utilizam o mesmo arquivo ScoreBoardFile.
#
ScoreBoardFile /var/run/apache.scoreboard

#
# Na configuração padrão, o servidor processará este arquivo, o 
# srm.conf e o access.conf neste ordem. Você pode fazer o servidor
# ignorar estes arquivos usando "/dev/null".
#
ResourceConfig /etc/apache/srm.conf
AccessConfig /etc/apache/access.conf

#
# A diretiva LockFile define o caminho do lockfile usado quando o servidor 
# Apache for compilado com a opção USE_FCNTL_SERIALIZED_ACCEPT ou
# USE_FLOCK_SERIALIZED_ACCEPT. Esta diretiva normalmente deve ser deixada em seu
# valor padrão. A razão principal de modifica-la é no caso do diretório de logs
# for montado via um servidor NFS< pois o arquivo especificado em LockFile
# DEVE SER ARMAZENADO EM UM DISCO LOCAL. O PID do processo do servidor principal
# é automaticamente adicionado neste arquivo.
#
LockFile /var/run/apache.lock

# ServerName permite ajustar o nome de host que será enviado 
# aos clientes, caso for diferente do nome real (por exemplo, se desejar usar 
# www ao invés do nome real de seu servidor).
#
# Nota: Você não pode simplesmente inventar nomes e esperar que funcionem. O nome
# que definir deverá ser um nome DNS válido para sua máquina. 

ServerName debian.meudominio.org

# UseCanonicalName: Com esta opção ligada, se o Apache precisar construir uma 
# URL de referência (uma url que é um retorno do servidor a uma requisição) ele 
# usará ServerName e Port para fazer o "nome canônico". Com esta opção desligada,
# o Apache usará computador:porta que o cliente forneceu, quando possível. 
# Isto também afeta SERVER_NAME e SERVER_PORT nos scripts CGIs.
# 
# Dependendo de sua configuração, principalmente em virtual hosts, é recomendável
# deixa-la desativada ou com o valor DNS. O valor DNS obtém o nome do servidor
# através de uma requisição DNS reversa do endereço IP (muito útil para virtual
# hosts baseados em IP).
UseCanonicalName off

# CacheNegotiatedDocs: Por padrão, o Apache envia Pragma: no-cache com cada 
# documento que foi negociado na base do conteúdo. Isto permite dizer a 
# servidores proxy para não fazerem cache do documento. Descomentando a 
# seguinte linha desativa esta característica, e os proxyes serão capazes
# de fazer cache dos documentos.

#CacheNegotiatedDocs

# Timeout: O número de segundos antes de receber e enviar um time out

Timeout 300

# KeepAlive: Se vai permitir ou não conexões persistentes (mais que uma requisição
# por conexão). Mude para "Off" para desativar.
KeepAlive On

# MaxKeepAliveRequests: O número máximo de requisições que serão permitidas 
# durante uma conexão persistente. Mude para 0 para permitir uma quantidade 
# ilimitada. Nós recomendamos deixar este número alto, para obter a máxima 
# performance

MaxKeepAliveRequests 100

# KeepAliveTimeout: Número de segundos que aguardará a próxima requisição

KeepAliveTimeout 15

# Regulagem do tamanho de pool do servidor. Ao invés de fazer você adivinhar
# quantos processos servidores precisará, o Apache adapta dinamicamente 
# de acordo com a carga que ele vê --- isto é, ele tenta manter o número de 
# processos o bastante para manipular a carga atual, mas alguns poucos 
# servidores esparsos para manipular requisições transientes (ex. requisições
# simultâneas múltiplas de um navegador Netscape simples).

# Ele faz isto verificando periodicamente quantos servidores estão 
# aguardando por uma requisição. Se lá existe menos que MinSpareServers, 
# ele cria um novo processo. Se existe mais que MaxSpareServers, ele 
# fecha alguns processos. Os valores abaixo estão adequados para muitos
# sites

MinSpareServers 5
MaxSpareServers 10

# Número de servidores que serão iniciados --- deve conter um valor razoável.

StartServers 5

# Limita o número total de servidores rodando, i.e., limita o número de clientes
# que podem conectar simultaneamente --- se este limite é sempre atingido,
# os clientes podem serão BARRADOS, assim este valor NÃO DEVE SER MUITO PEQUENO.
# Ele tem a intenção principal de ser um freio para manter um em execução com 
# uma performance aceitável de acordo com os requerimentos de construção e 
# carga calculada no servidor.

MaxClients 150

#
# MaxRequestsPerChild: O número de requisições que cada processo tem permissão
# de processar antes do processo filho ser finalizado. O filho será finalizado 
# para evitar problemas após uso prolongado quando o Apache (e talvez as 
# bibliotecas que utiliza) tomar memória e outros recursos. Na maioria dos 
# sistemas, isto realmente não é necessário, exceto para alguns (como o 
# Solaris) que possuem ponteiros notáveis em suas bibliotecas. Para estas 
# plataformas, ajuste para algo em torno de 10000 ou algo assim; uma
# configuração de 0 significa ilimitado. 
#
# NOTA: Este valor não inclui requisições keepalive após a requisição
#       inicial por conexão. Por exemplo, se um processo filho manipula
#       uma requisição inicial e 10 requisições "keptalive" subseqüentes, 
#       ele somente contará 1 requisição neste limite.
#
MaxRequestsPerChild 30


# Listen: Permite fazer o Apache escutar um IP determinado e/ou porta, em 
# adição a padrão. Veja também o comando VirtualHost

#Listen 3000
#Listen 12.34.56.78:80

# VirtualHost: Permite o daemon responder a requisições para mais que um 
# endereço IP do servidor, se sua máquina estiver configurada para aceitar pacotes
# para múltiplos endereços de rede. Isto pode ser feito com a opção de aliasing
# do ifconfig ou através de patches do kernel como o de VIF.

# Qualquer diretiva httpd.conf ou srm.conf pode ir no comando VirtualHost.
# Veja também a entrada BindAddress.

#&lt;VirtualHost host.some_domain.com&gt;
#ServerAdmin webmaster@host.some_domain.com
#DocumentRoot /var/www/host.some_domain.com
#ServerName host.some_domain.com
#ErrorLog /var/log/apache/host.some_domain.com-error.log
#TransferLog /var/log/apache/host.some_domain.com-access.log
#&lt;/VirtualHost&gt;


# VirtualHost: Se você quiser manter múltiplos domínios/nomes de máquinas em sua 
# máquina você pode ajustar o conteúdo de VirtualHost para eles.
# Por favor veja a documentação em &lt;http://www.apache.org/docs/vhosts/&gt;
# para mais detalhes antes de tentar configurar seus hosts virtuais.
# Você pode usar a opção de linha de comando '-S' para verificar sua configuração
# de hosts virtuais.

#
# Se desejar usar hosts virtuais baseados em nome, será necessário definir no
# mínimo um endereço IP (e número de porta) para eles.
#
#NameVirtualHost 12.34.56.78:80
#NameVirtualHost 12.34.56.78

#
# Exemplo de um Host Virtual:
# Praticamente qualquer diretiva do Apache pode entrar na condicional 
# VirtualHost.
#
#&lt;VirtualHost ip.address.of.host.some_domain.com&gt;
#    ServerAdmin webmaster@host.some_domain.com
#    DocumentRoot /www/docs/host.some_domain.com
#    ServerName host.some_domain.com
#    ErrorLog logs/host.some_domain.com-error.log
#    CustomLog logs/host.some_domain.com-access.log common
#&lt;/VirtualHost&gt;

#&lt;VirtualHost _default_:*&gt;
#&lt;/VirtualHost&gt;
</screen>
</section>

<section id="s-apache-exemplo-srm"><title>srm.conf</title>
<screen>
# Neste arquivo são definidos o espaço de nomes que os usuários visualizarão no
# seu servidor http. Este arquivo também define configurações do servidor que
# afetam como as requisições são servidas e como os resultados deverão ser 
# formatados. 

# Veja os tutoriais em http://www.apache.org/ para mais detalhes

# DocumentRoot: O diretório principal onde você servira seus documentos.
# Por padrão, todas as requisições são tomadas através deste diretório, 
# exceto links simbólicos e aliases que podem ser usados para apontar para
# outras localizações no sistema de arquivos.
DocumentRoot /var/www

#
# UserDir: O nome do diretório que será adicionado ao diretório home do usuário
# caso uma requisição ~usuário for recebida.
#
&lt;IfModule mod_userdir.c&gt;
    # Linha abaixo por recomendação de segurança do manual do Apache
    UserDir disabled root
    UserDir public_html
&lt;/IfModule&gt;


#
# DirectoryIndex: Nome do arquivo ou arquivos que serão usados como índice do 
# diretório. Especifique mais de um arquivos separados por espaços ao invés
# de um só um nome (como "index") para aumentar a performance do servidor. 
#
&lt;IfModule mod_dir.c&gt;
    DirectoryIndex index.html index.htm index.shtml index.cgi
&lt;/IfModule&gt;

#
# Diretivas que controlam a exibição de listagem de diretórios geradas pelo servidor.
#

&lt;IfModule mod_autoindex.c&gt;

    #
    # FancyIndexing: se você deseja o padrão fancy index ou padrão para a indexação
    #                de arquivos no diretório. Usando FancyIndexing o servidor
    #                apache gerará uma listagem de arquivos que poderá ser 
    #                ordenada, usar tipos de ícones e encoding, etc. Veja as 
    #                próximas opções
    IndexOptions FancyIndexing

    #
    # As diretivas AddIcon* dizem ao servidor que ícone mostrar para um determinado
    # arquivo ou extensão de arquivos. Estes somente são mostrados para os 
    # diretórios classificados através da opção FancyIndexing.
    #
    AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip

    AddIconByType (TXT,/icons/text.gif) text/*
    AddIconByType (IMG,/icons/image2.gif) image/*
    AddIconByType (SND,/icons/sound2.gif) audio/*
    AddIconByType (VID,/icons/movie.gif) video/*

    AddIcon /icons/binary.gif .bin .exe
    AddIcon /icons/binhex.gif .hqx
    AddIcon /icons/tar.gif .tar
    AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
    AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
    AddIcon /icons/a.gif .ps .ai .eps
    AddIcon /icons/layout.gif .html .shtml .htm .pdf
    AddIcon /icons/text.gif .txt
    AddIcon /icons/c.gif .c
    AddIcon /icons/p.gif .pl .py
    AddIcon /icons/f.gif .for
    AddIcon /icons/dvi.gif .dvi
    AddIcon /icons/uuencoded.gif .uu
    AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
    AddIcon /icons/tex.gif .tex
    AddIcon /icons/bomb.gif */core
    AddIcon /icons/deb.gif .deb Debian

    AddIcon /icons/back.gif ..
    AddIcon /icons/hand.right.gif README
    AddIcon /icons/folder.gif ^^DIRECTORY^^
    AddIcon /icons/blank.gif ^^BLANKICON^^

    # DefaultIcon é o ícone que será mostrado para aplicativos que não tiverem um 
    # ícone explicitamente definido.

    DefaultIcon /icons/unknown.gif

    #
    # AddDescription: isto lhe permite colocar uma curta descrição após um arquivo
    # nos índices gerados pelo servidor. Estes somente são mostrados para diretórios
    # com índices organizados usando a opção FancyIndexing.
    # Formato: AddDescription "descrição" extensão
    #
    #AddDescription "GZIP compressed document" .gz
    #AddDescription "tar archive" .tar
    #AddDescription "GZIP compressed tar archive" .tgz


    # ReadmeName é o nome do arquivo LEIAME que o servidor procurará como 
    # padrão. Estes serão inseridos no fim da listagem de diretórios.
    Formato: ReadmeName nome
    #
    # O servidor procurará primeiro por nome.html, incluído se ele for encontrado,
    # e então procurará pelo nome e incluirá ele como texto plano se encontrado..

    ReadmeName README
    
    # HeaderName é o nome do arquivo que deve ser colocado no topo do índice
    # de diretórios. As regras de procura de nome são as mesmas do arquivo
    # README
    HeaderName HEADER

    #
    # IndexIgnore: um conjunto de nomes de arquivos que a listagem de diretórios
    # deve ignorar e não incluir na listagem. É permitido o uso de coringas 
    # como no interpretador de comandos.
    #
    IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t

&lt;/IfModule&gt;

# AccessFileName: O nome do arquivo que será procurado em cada diretório
# que contém detalhes sobre as permissões de acesso a um determinado 
# diretório e opções de listagem. Tenha cuidado ao modificar o nome 
# deste arquivo, muitas definições que trabalham em cima do nome
# .htaccess nos arquivos de configuração deverão ser modificados para
# não comprometer a segurança de seu servidor. 
# Uma falta de atenção neste ponto poderá deixar este arquivo visível
# em qualquer listagem de diretórios facilmente...

AccessFileName .htaccess

# TypesConfig especifica o arquivo de configuração que contém os tipos
# usados pelo servidor
TypesConfig /etc/mime.types

#
# DefaultType é o tipo MIME padrão que o servidor utilizará para um documento
# caso ele não possa determinar seu conteúdo, como através de extensões 
# de arquivos. Se o servidor contém em sua maioria texto ou documentos em HTML,
# "text/plain" é um bom valor. Caso a maioria do conteúdo seja binários, tal
# como aplicativos ou fotos, o tipo mais adequado ao seu caso poderá ser 
# "application/octet-stream" para evitar que navegadores tentem exibir
# aplicativos binários como se fossem texto.
# Se desejar uma referência rápida sobre tipos mime, consulte o arquivo
# /etc/mime.types
#
DefaultType text/plain

#
# Document types.
#
&lt;IfModule mod_mime.c&gt;

    # AddEncoding permite que alguns navegadores (Mosaic/X 2.1+, Netscape, etc)
    # descompactem dados durante sua abertura. N
    # Nota: Nem todos os navegadores suportam isto. Esqueça os nomes parecidos,
    # as seguintes diretivas Add* não tem nada a ver com personalizações
    # da opção FancyIndexing usada nas diretivas acima.

    AddEncoding x-compress Z
    AddEncoding x-gzip gz tgz

    #
    # AddLanguage: permite especificar o idioma do documento. Você pode
    # então usar a negociação de conteúdo para dar ao navegador um 
    # arquivo no idioma solicitado.
    #
    # Nota 1: O sufixo não precisa ser o mesmo da palavra chave do 
    # idioma --- estes com o documento em Polonês (no qual o 
    # código padrão da rede é pl) pode desejar usar "AddLanguage pl .po" 
    # para evitar confusão de nomes com a extensão comum de scripts
    # scripts em linguagem Perl.
    #
    # Nota 2: As entradas de exemplos abaixo mostram que em alguns casos
    # as duas letras de abreviação do 'Idioma' não é idêntico as duas letras
    # do 'País' para seu país, como 'Danmark/dk' versus 'Danish/da'.
    #
    # Nota 3: No caso de 'ltz' nós violamos a RFC usando uma especificação de 
    # três caracteres. Mas existe um 'trabalho em progresso' para corrigir isto
    # e obter os dados de referência para limpar a RFC1766.
    #
    # Danish (da) - Dutch (nl) - English (en) - Estonian (ee)
    # French (fr) - German (de) - Greek-Modern (el)
    # Italian (it) - Portugese (pt) - Luxembourgeois* (ltz)
    # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
    # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
    #
    AddLanguage da .dk
    AddLanguage nl .nl
    AddLanguage en .en
    AddLanguage et .ee
    AddLanguage fr .fr
    AddLanguage de .de
    AddLanguage el .el
    AddLanguage it .it
    AddLanguage ja .ja
#    AddCharset ISO-2022-JP .jis
    AddLanguage pl .po
#    AddCharset ISO-8859-2 .iso-pl
    AddLanguage pt .pt
    AddLanguage pt-br .pt-br
    AddLanguage ltz .lu
    AddLanguage ca .ca
    AddLanguage es .es
    AddLanguage sv .se
    AddLanguage cz .cz

    # LanguagePriority: permite definir a prioridade para a exibição de 
    # documentos caso nenhum documento confira durante a negociação de 
    # conteúdo.
    #
    # Para fazer isto, especifique os idiomas em ordem de preferência de exibição
    # de idiomas. 
    #
    &lt;IfModule mod_negotiation.c&gt;
        LanguagePriority pt-br pt es en da nl et fr de el it ja pl ltz ca sv
    &lt;/IfModule&gt;

    #
    # AddType permite modificar o mime.types sem editar o arquivo, ou fazer 
    # a associação de arquivos a certos tipos de conteúdo.
    #
    # Por exemplo, o módulo PHP 3.x (que não faz parte da distribuição do 
    # Apache - veja http://www.php.net) tipicamente utiliza isto:
    #
    #AddType application/x-httpd-php3 .php3
    #AddType application/x-httpd-php3-source .phps
    #
    # E para arquivos PHP 4.x use:
    #
    #AddType application/x-httpd-php .php
    #AddType application/x-httpd-php-source .phps

    AddType application/x-tar .tgz
    AddType image/bmp .bmp

    # hdml
    AddType text/x-hdml .hdml

    #
    # AddHandler permite mapear certas extensões de arquivos a programas
    # "manipuladores" adequados a seu conteúdo. Estes podem ser construídos
    # no servidor ou adicionados com o comando Action (veja abaixo).
    #
    # Se desejar usar includes no lado do servidor, ou servir diretórios
    # com scripts CGI para fora, descomente as seguintes linhas.
    #
    # Para usar scripts CGI:
    #
    #AddHandler cgi-script .cgi .sh .pl

    #
    # Para usar arquivos html gerados através do servidor
    #
    #AddType text/html .shtml
    #AddHandler server-parsed .shtml

    #
    # Descomente as seguintes linhas para ativar a características de arquivos
    # send-asis HTTP do servidor Apache
    #
    #AddHandler send-as-is asis

    #
    # Se desejar usar arquivos de mapas de imagens processadas no servidor, use
    #
    #AddHandler imap-file map

    #
    # Para ativar tipo de mapas, você poderá usar
    #
    #AddHandler type-map var

&lt;/IfModule&gt;
# Fim dos tipos de documentos

# Preferências padrões de exibição de caracteres (veja http://www.apache.org/info/css-security/).

AddDefaultCharset on
AddDefaultCharsetName iso-8859-1

# Redirect permite dizer aos clientes que documentos não existem mais no seu servidor 
# e a nova localização do documento. 
# Format: Redirect nomeurl url
# "nomeurl" é o caminho especificado na url e "url" é a nova localização do 
# documento

# Aliases: Inclua aqui quantos apelidos você desejar (sem limite) o formato é:
# Alias nomeurl nomereal
# "nomeurl" é o caminho especificado na url e "nomereal" é a localização
# do documento no sistema de arquivos local

# Note que se você incluir uma / no fim de "nomeurl", então o servidor 
# requisitará que também esteja presente na URL. 

Alias /icons/ /usr/share/apache/icons/
Alias /doc/ /usr/doc/
Alias /focalinux /var/www/focalinux
Alias /debian-br /var/www/debian-br/htdocs
Alias /debian /pub/mirror/debian

# ScriptAlias: Esta diretiva controla que diretórios contém scripts do servidor.
# Format: ScriptAlias fakename realname

ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/

#
# Action: permite definir os tipos de mídia que executarão um script quando um 
# arquivo que conferir for chamado. Isto elimina a necessidade de caminhos de URLs
# repetidas para processadores de arquivos CGI freqüentemente usados.
# Format: Action media/type /cgi-script/location
# Format: Action handler-name /cgi-script/location
#

#
# MetaDir: especifica o nome do diretório no qual o apache procurará arquivos de 
# detalhes do módulo mod_cern_meta. Os módulos meta contém cabeçalhos HTTP
# adicionais que serão incluídos durante o envio do documento. 
#
#MetaDir .web

#
# Resposta de erros personalizada (no estilo do Apache)
# estas podem ser 3 tipos:
#
#    1) texto plano
#ErrorDocument 500 "O servidor fez boo boo.
#  n.b.  a aspa (") marca como texto, ela não será exibida
#
#    2) redirecionamentos locais
#ErrorDocument 404 /missing.html
#  para redirecionar para a URL local /missing.html
#ErrorDocument 404 /cgi-bin/missing_handler.pl
#  N.B.: É também possível redirecionar a um script o documento usando includes
#  do lado do servidor (server-side-includes).
#
#    3) redirecionamentos externos
#ErrorDocument 402 http://algum.outro_servidor.com/inscricao.html
#  N.B.: Muitas das variáveis de ambientes associada com a requisição atual *não*
# estarão disponíveis para tal script.

#
# O módulo mod_mime_magic permite o servidor usar várias dicas através do conteúdo
# do arquivo para determinar o seu tipo. A diretiva MIMEMagicFile diz ao módulo
# onde as definições de dicas estão localizadas. O módulo mod_mime_magic não é 
# parte do servidor padrão Apache (você precisará adiciona-lo manualmente com 
# uma linha LoadModule (veja o parágrafo DSO na seção Ambiente Global no 
# arquivo httpd.conf), ou recompile o servidor e inclua mod_mime_magic como
# parte de sua configuração), por este motivo ele está entre as condicionais
# &lt;IfModule&gt;. Isto significa que a diretiva MIMEMagicFile somente será processada
# caso o módulo estiver ativo no servidor. 
#
&lt;IfModule mod_mime_magic.c&gt;
    MIMEMagicFile conf/magic
&lt;/IfModule&gt;


&lt;IfModule mod_setenvif.c&gt;
    #
    # As seguintes diretivas modificam o funcionamento da resposta normal do 
    # servidor HTTP.
    # A primeira diretiva desativa o keepalive para o Netscape 2.x e navegadores que
    # as falsificam. Existem problemas conhecidos com estas implementações de 
    # navegadores. A segunda diretiva é para o MS IE 4.0b2 que tem uma implementação
    # defeituosa do HTTP/1.1 e não suporta adequadamente o keepalive quando ele
    # utiliza as respostas de redirecionamento 301 e 302.
    #
    BrowserMatch "Mozilla/2" nokeepalive
    BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0

    #
    # As seguintes diretivas desativam as respostas HTTP/1.1 para navegadores que
    # violam a especificação HTTP/1.0 não sendo capaz de enviar uma resposta 
    # 1.1 básica.
    #
    BrowserMatch "RealPlayer 4\.0" force-response-1.0
    BrowserMatch "Java/1\.0" force-response-1.0
    BrowserMatch "JDK/1\.0" force-response-1.0
&lt;/IfModule&gt;

# Se o módulo Perl está instalado, isto será ativado.
&lt;IfModule mod_perl.c&gt;
  Alias /perl/ /var/www/perl/
  &lt;Location /perl&gt;
    Options +ExecCGI
    SetHandler perl-script
    PerlHandler Apache::Registry
  &lt;/Location&gt;
&lt;/IfModule&gt;
</screen>
</section>

<section id="s-apache-exemplo-access"><title>access.conf</title>
<screen>
# access.conf: Configuração de acesso Global
# Documentos on-line em http://www.apache.org/

# Este arquivo define as configurações do servidor que afetam que tipos de 
# serviços são permitidos e em quais circunstâncias. 

# Cada diretório que o Apache possui acesso, pode ser configurado respectivamente
# com quais serviços e características que podem ser permitidas e/ou bloqueadas 
# no diretório (e seus subdiretórios).
#
# Primeiro a configuração restringe uma série de permissões
&lt;Directory /&gt;
    Options SymLinksIfOwnerMatch
    AllowOverride None
#    Order deny,allow
#    Deny from all
&lt;/Directory&gt;

# Desse ponto em diante, é necessário especificar o que será permitido
# caso contrário será bloqueado pelo bloco acima

# Esta parte deve ser modificada para a localização do documento raíz do servidor.

&lt;Directory /var/www&gt;

# A opção Options pode conter os valores "None", "All", ou quaisquer combinação
# de "Indexes", "Includes", "FollowSymLinks", "ExecCGI", ou "MultiViews".
#
# Note que "MultiViews" deve ser *explicitamente* especificada --- "Options All"
# não a ativa (pelo menos não ainda).

Options Indexes FollowSymLinks Includes MultiViews

# Esta opção controla que opções os arquivos .htaccess nos diretórios podem ser
# substituídas. Pode também conter "All", ou qualquer combinação de "Options", 
# "FileInfo", "AuthConfig", e "Limit"

AllowOverride None

# Controla quem pode obter materiais deste servidor. Leia a seção adequada no
# guia para mais explicações sobre a ordem de acesso, padrões e valores permitidos.

order allow,deny
allow from all

&lt;/Directory&gt;

#
# O diretório "/usr/lib/cgi-bin" deve ser modificado para o diretório que 
# possuem seus scripts CGI, caso tenha configurado o suporte a CGI's no 
# servidor. 
#
&lt;Directory /usr/lib/cgi-bin/&gt;
    AllowOverride None
    Options ExecCGI
    Order allow,deny
    Allow from all
&lt;/Directory&gt;

#
# Permite ver relatórios de status e funcionamento do servidor web e 
# processos filhos, através da URL http://servidor/server-status
# isto requer o módulo status_module (mod_status.c) carregado no arquivo 
# httpd.conf
#
#&lt;Location /server-status&gt;
#    SetHandler server-status
#    Order deny,allow
#    Deny from all
#    Allow from .meudominio.org
#&lt;/Location&gt;

#
# Permite relatório de configuração remota do servidor, através da URL 
# http://servername/server-info 
# Isto requer o módulo info_module (mod_info.c) carregado no arquivo 
# httpd.conf
#
#&lt;Location /server-info&gt;
#    SetHandler server-info
#    Order deny,allow
#    Deny from all
#    Allow from .meudominio.org
#&lt;/Location&gt;

# Visualização do diretório de ícones
&lt;Directory /usr/share/apache/icons&gt;
    Options Indexes MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all
&lt;/Directory&gt;


# O Debian Policy assume que /usr/doc é "/doc/" e linkado com /usr/share/doc, 
# pelo menos para localhost.

&lt;Directory /usr/doc&gt;
   Options Indexes FollowSymLinks 
   order deny,allow
   deny from all
   allow from 192.168.1.10/24
&lt;/Directory&gt;

# Esta define a localização visualizável do monitor de status mod_throttle
#
&lt;location /throttle-info&gt;
   SetHandler throttle-info
&lt;/location&gt;

#
# As seguintes linhas previnem os arquivos .htaccess de serem mostrados nos
# clientes Web. Pois os arquivos .htaccess freqüentemente contém detalhes
# de autorização, o acesso é desabilitado por razões de segurança. Comente
# estas linhas se desejar que seus visitantes vejam o conteúdo dos arquivos
# .htaccess. Se modificar a diretiva AccessFileName acima, tenha certeza de 
# fazer as modificações correspondentes aqui.
#
# As pessoas também tendem a usar nomes como .htpasswd nos arquivos de senhas
# a diretiva abaixo os protegerá também.
#
&lt;Files ~ "^\.ht"&gt;
    Order allow,deny
    Deny from all
&lt;/Files&gt;

#
# Controla o acesso a diretórios UserDir. As seguintes diretivas são um exemplo
# para um site onde estes diretórios estão restritos a somente-leitura. Veja
# detalhes sobre as opções de acesso, e limites na seção sobre controle
# de acesso do guia
#
&lt;Directory /home/*/public_html&gt;
    AllowOverride FileInfo AuthConfig Limit
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    &lt;Limit GET POST OPTIONS PROPFIND&gt;
        Order allow,deny
        Allow from all
    &lt;/Limit&gt;
    &lt;Limit PUT DELETE PATCH PROPPATCH MKCOL COPY MOVE LOCK UNLOCK&gt;
        Order deny,allow
        Deny from all
    &lt;/Limit&gt;
&lt;/Directory&gt;

#
# As vezes ocorrem relatos de pessoas tentando abusar de uma falha antiga nos 
# dias do Apache 1.1 (muitas páginas na Net documentam isso). Esta falha envolve
# um script CGI distribuído como parte do Apache. Descomentando estas linhas você
# poderá redirecionar estes ataques a um script de registro em phf.apache.org. Ou
# poderá gravar em sua própria máquina, usando o script support/phf_abuse_log.cgi.
#
#&lt;Location /cgi-bin/phf*&gt;
#    Deny from all
#    ErrorDocument 403 http://phf.apache.org/phf_abuse_log.cgi
#&lt;/Location&gt;


# Acesso aos serviços proxy do apache
#&lt;Directory proxy:*&gt;
#    Order deny,allow
#    Deny from all
#    Allow from .your_domain.com
#&lt;/Directory&gt;

# a seguinte diretiva permite o acesso a todos os usuários ao conteúdo da página
# do guia Foca GNU/Linux exceto os que possuem navegadores MSIE ;-)
# Veja a seção sobre restrições de acesso para detalhes sobre a diretiva de 
# controle de acesso baseado no user-agent
SetEnvIf User-Agent MSIE EXPLODER
&lt;Directory /var/www/focalinux&gt;
 Options Indexes
 Order allow,deny
 allow from all
 deny from env=EXPLODER
 ErrorDocument 403 "Explorer não entra, página com o conteúdo potencialmente perigoso ao Windows, use um navegador seguro para ter acesso a esta página ;-)
&lt;/Directory&gt;

# A diretiva abaixo somente permite acesso a leitura do arquivo
# h-supor-fonte.txt a pessoas que fornecerem o nome/senha corretos
# que constam no arquivo passwd1
# Este bloco contém um erro que é a localização do arquivo da senha em um
# diretório público, você deverá adapta-lo se não quiser se ver em apuros.
#
# A permissão do diretório de nível superior prevalece sobre seus 
# sub-diretórios no caso as permissões de /focalinux, a menos que 
# sejam definidas opções de acesso específicas ao arquivo abaixo
&lt;Location /focalinux/humor/h-supor-fonte.txt&gt;
 AuthName "Piada de fonte de alimentação"
 AuthType basic
 AuthUserFile /home/gleydson/public_html/passwd1
 Require valid-user
# Satisfy all
&lt;/Location&gt;

# Libera o acesso a localização /debian (acessada através de /pub/mirror/debian, 
# definida no Alias acima)
&lt;Location /debian&gt;
 Options Indexes
 Order deny,allow
 allow from all
 deny from all
&lt;/Location&gt;
</screen>
</section>

</section>

<section id="s-apache-httpcodes"><title>Códigos HTTP</title>
<para>
Esta seção pode ser uma interessante referência para a programação e
configuração da diretiva <emphasis>ErrorDocument</emphasis>, etc.
</para>
<variablelist>
<varlistentry>
<term>2xx - Sucesso</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>200</literal> OK
</para>
</listitem>
<listitem>
<para>
<literal>201</literal> Criado
</para>
</listitem>
<listitem>
<para>
<literal>202</literal> Aceito
</para>
</listitem>
<listitem>
<para>
<literal>203</literal> Informação não-autoritativa *
</para>
</listitem>
<listitem>
<para>
<literal>204</literal> Nenhum conteúdo
</para>
</listitem>
<listitem>
<para>
<literal>205</literal> Conteúdo resetado *
</para>
</listitem>
<listitem>
<para>
<literal>206</literal> Conteúdo parcial *
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>3xx - Redirecionamento</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>300</literal> Múltiplas escolhas
</para>
</listitem>
<listitem>
<para>
<literal>301</literal> Movido Permanentemente
</para>
</listitem>
<listitem>
<para>
<literal>302</literal> Movido Temporariamente
</para>
</listitem>
<listitem>
<para>
<literal>303</literal> Veja outra *
</para>
</listitem>
<listitem>
<para>
<literal>304</literal> Não modificada
</para>
</listitem>
<listitem>
<para>
<literal>305</literal> Use o Proxy (redirecionamento proxy) *
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>4xx - Erros no Cliente</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>400</literal> Requisição incorreta
</para>
</listitem>
<listitem>
<para>
<literal>401</literal> Não autorizado
</para>
</listitem>
<listitem>
<para>
<literal>402</literal> Pagamento Requerido *
</para>
</listitem>
<listitem>
<para>
<literal>403</literal> Bloqueado
</para>
</listitem>
<listitem>
<para>
<literal>404</literal> Não encontrada
</para>
</listitem>
<listitem>
<para>
<literal>405</literal> Método não permitido *
</para>
</listitem>
<listitem>
<para>
<literal>406</literal> Não aceitável *
</para>
</listitem>
<listitem>
<para>
<literal>407</literal> Autenticação via proxy requerida *
</para>
</listitem>
<listitem>
<para>
<literal>408</literal> Tempo limite da requisição expirado *
</para>
</listitem>
<listitem>
<para>
<literal>409</literal> Conflito *
</para>
</listitem>
<listitem>
<para>
<literal>410</literal> Gone *
</para>
</listitem>
<listitem>
<para>
<literal>411</literal> Tamanho requerido *
</para>
</listitem>
<listitem>
<para>
<literal>412</literal> Falha na pré-condição *
</para>
</listitem>
<listitem>
<para>
<literal>413</literal> A requisição parece ser grande *
</para>
</listitem>
<listitem>
<para>
<literal>414</literal> A URL requisitada é muito longa *
</para>
</listitem>
<listitem>
<para>
<literal>415</literal> Tipo de mídia não suportado
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>5xx - Erros no Servidor</term>
<listitem>
<itemizedlist>
<listitem>
<para>
<literal>500</literal> Erro Interno no Servidor
</para>
</listitem>
<listitem>
<para>
<literal>501</literal> Não implementado
</para>
</listitem>
<listitem>
<para>
<literal>502</literal> Gateway incorreto
</para>
</listitem>
<listitem>
<para>
<literal>503</literal> Serviço não disponível
</para>
</listitem>
<listitem>
<para>
<literal>504</literal> Tempo limite no gateway *
</para>
</listitem>
<listitem>
<para>
<literal>505</literal> Versão HTTP não suportada *
</para>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<para>
Os códigos de erros marcados com um "*" pertencem ao padrão HTTP 1.1
</para>
</section>

</chapter>

